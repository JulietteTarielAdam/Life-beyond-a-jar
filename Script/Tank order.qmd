---
title: "Order of tanks"
format: html
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
# Run the scripts that load the data and that contains the functions to plot and do the linear models
source("Script/Load-data.R")
source("Script/Functions/Plots.R")
source("Script/Functions/Linear-model.R")
```

Order in which the fish experienced the tanks. Fish underwent different order of treatments: Some fish started with Large, then Small, etc; Other fish with Medium, then Jar, etc. Barren was the last tank = 5th tank for all fish. Is there an effect of the order of treatments? For instance, were fish more swimming on average during the 1st or 2nd tnak they went in?  

A problem because all fish experienced Barren last, we cannot disentangle the effect of Barren from the effect of order. Maybe all the changes in behaviour in Barren were only because it was the last tank the fish went into. At least, we are comparing Large and Barren -Large is not always the 4th tank- so we are not always comparing the same tank orders when comparing Large and Barren. 

We can only investigate the effect of order when excluding Barren. It is then missing up the analysis we did before because we were analysing all tanks together; it is a bit of a pain to do two models for each behaviour (one for Jar, Small, Medium and Large, and one for Large and Barren). Don't know what to do, wait if the reviewers say something? Or change the analysis? 

```{r}
#| warning: false
data %>% filter(Tank != "Barren") %>% 
  plot1("Order", main = .) +
  ggtitle("Tank order")
```

Treat tank order as a continuous or categorical variable? 

```{r}
plot(data$Swimming ~ factor(data$Order))
ggplot(data, aes(y = Swimming, x = Order)) + geom_point() + geom_smooth()
```

Considering the plot of the relationship between Swimming and Tank order, tank order is better as a categorical variable.

```{r}
# with tank order as categorical variable
mOrder.fac <- lmer(Swimming ~ Tank + Time + Filter + factor(Order) + (1|Fish), data = filter(data, Tank !="Barren"))
# with tank order as continuous variable
mOrder.con <-  lmer(Swimming ~ Tank + Time + Filter + Order + (1|Fish), data = filter(data, Tank !="Barren"))
# with tank order and squared tank order
mOrder.con2 <-  lmer(Swimming ~ Tank + Time + Filter + Order + I(Order^2) + (1|Fish), data = filter(data, Tank !="Barren"))

AIC(mOrder.fac,mOrder.con, mOrder.con2)


anova(model, ddf = "Kenward-Roger", type = 2) 
emmeans(model, ~ Tank) %>% 
  contrast(.,
           list(jar_vs_small     = c(1,-1, 0, 0), 
                jar_vs_medium    = c(1, 0,-1, 0), 
                jar_vs_large     = c(1, 0, 0,-1),
                small_vs_medium  = c(0, 1,-1, 0),
                small_vs_large   = c(0, 1, 0,-1), 
                medium_vs_large  = c(0, 0, 1,-1)),
           adjust = "holm")
# without tank order
lmer(Swimming ~ Tank + Time + Filter + (1|Fish), data = filter(data, Tank !="Barren")) %>% 
  anova(., ddf = "Kenward-Roger", type = 2)
```

Comparison of all models (besides Hovering and Interaction with surface) with or without tank order in the model, excluding Barren data

Significant effect of tank order
Still an effect of tank

```{r}
# with tank order
model <- lmer(Resting ~ Tank + Time + Filter + factor(Order) + (1|Fish), data = filter(data, Tank !="Barren"))
anova(model, ddf = "Kenward-Roger", type = 2) 
emmeans(model, ~ Tank) %>% 
  contrast(.,
           list(jar_vs_small     = c(1,-1, 0, 0), 
                jar_vs_medium    = c(1, 0,-1, 0), 
                jar_vs_large     = c(1, 0, 0,-1),
                small_vs_medium  = c(0, 1,-1, 0),
                small_vs_large   = c(0, 1, 0,-1), 
                medium_vs_large  = c(0, 0, 1,-1)),
           adjust = "holm")
# without tank order
lmer(Resting ~ Tank + Time + Filter + (1|Fish), data = filter(data, Tank !="Barren")) %>% 
  anova(., ddf = "Kenward-Roger", type = 2)
```

Significant effect of tank order
Still an effect of tank

```{r}
glmmTMB(Foraging.bin ~ Tank + Time + Filter + factor(Order) + (1|Fish), data = filter(data, Tank !="Barren"), family =binomial) %>% 
  Anova(.)
```

No effect of tank order
Still an effect of tank

```{r}
glmmTMB(Nest.bin ~ Tank + Time + Filter + factor(Order) + (1|Fish), data = filter(data, Tank !="Barren"), family =binomial) %>% 
  Anova(.)
```

No effect of tank order
Lose the effect of tank

```{r}
glmmTMB(SS.bin ~ Tank + Time + Filter + factor(Order) + (1|Fish), data = filter(data, Tank !="Barren"), family =binomial) %>% 
  Anova(.)
```

No effect of tank order
Still an effect of tank