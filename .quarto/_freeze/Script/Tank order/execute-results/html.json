{
  "hash": "3ce47f536f5b0d1db5caf11941ca50ff",
  "result": {
    "markdown": "---\ntitle: \"Order of tanks\"\ndate: \"2024-07-25\"\nauthor: \"Juliette Tariel-Adam\"\nformat: \n   html:\n    embed-resources: true\n    self-contained-math: true\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk:\n    fig-align: center\n    out-width: \"100%\"\n---\n\n\n\n\nOrder in which the fish experienced the tanks. Fish underwent different order of treatments: Some fish started with Large, then Small, etc; Other fish with Medium, then Jar, etc. Barren was the last tank = 5th tank for all fish. Is there an effect of the order of treatments? For instance, were fish more swimming on average during the 1st or 2nd tank they went in?  \n\nA problem because all fish last experienced Barren, we cannot disentangle the effect of Barren from the effect of order. Maybe all the changes in behaviour in Barren were only because it was the last tank the fish went into. At least, we are comparing Large and Barren, as Large is not always the 4th tank, we are not always comparing the same tank orders when comparing Large and Barren. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata %>% filter(Tank != \"Barren\") %>% \n  plot1(\"Order\", main = .) +\n  ggtitle(\"Tank order\")\n```\n\n::: {.cell-output-display}\n![](Tank-order_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n# Swimming\n\nTreat tank order as a continuous or categorical variable? \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(data$Swimming ~ data$Order.fac)\n```\n\n::: {.cell-output-display}\n![](Tank-order_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(y = Swimming, x = Order)) + geom_point() + geom_smooth()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](Tank-order_files/figure-html/unnamed-chunk-3-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nConsidering the plot of the relationship between Swimming and Tank order (no linear relationship), tank order is better as a categorical variable.\n\nAfter, comparison of models with or without tank order, on the full or subset dataset without Barren.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# With tank order on data without Barren\nmOrder.Swimming.subset <- lmer(Swimming ~ Tank + Time + Filter + Order.fac + (1|Fish), data = filter(data, Tank !=\"Barren\"))\nanova(mOrder.Swimming.subset , ddf = \"Kenward-Roger\", type = 2) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n          Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank      221999   74000     3 186.51 14.9390 9.339e-09 ***\nTime      280876   93625     3 181.03 18.9026 1.039e-10 ***\nFilter     49584   49584     1 167.19 10.0107  0.001849 ** \nOrder.fac  66288   22096     3 183.03  4.4611  0.004742 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nemmeans(mOrder.Swimming.subset, ~ Tank) %>% \n  contrast(.,\n           list(jar_vs_small     = c(1,-1, 0, 0), \n                jar_vs_medium    = c(1, 0,-1, 0), \n                jar_vs_large     = c(1, 0, 0,-1),\n                small_vs_medium  = c(0, 1,-1, 0),\n                small_vs_large   = c(0, 1, 0,-1), \n                medium_vs_large  = c(0, 0, 1,-1)),\n           adjust = \"holm\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n contrast        estimate   SE  df t.ratio p.value\n jar_vs_small      -18.11 14.3 182  -1.268  0.6191\n jar_vs_medium     -21.09 17.0 191  -1.239  0.6191\n jar_vs_large      -95.84 16.7 190  -5.739  <.0001\n small_vs_medium    -2.98 16.6 192  -0.180  0.8574\n small_vs_large    -77.73 16.4 191  -4.739  <.0001\n medium_vs_large   -74.75 13.9 181  -5.364  <.0001\n\nResults are averaged over the levels of: Time, Filter, Order.fac \nDegrees-of-freedom method: kenward-roger \nP value adjustment: holm method for 6 tests \n```\n:::\n\n```{.r .cell-code}\n# Without tank order on data without Barren\nmSwimming.subset <-lmer(Swimming ~ Tank + Time + Filter + (1|Fish), data = filter(data, Tank !=\"Barren\")) \nanova(mSwimming.subset , ddf = \"Kenward-Roger\", type = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n       Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank   238424   79475     3 189.62  15.143 7.100e-09 ***\nTime   280876   93625     3 184.03  17.841 3.299e-10 ***\nFilter  86224   86224     1 168.97  16.431 7.684e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nAIC(mOrder.Swimming.subset , mSwimming.subset)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       df      AIC\nmOrder.Swimming.subset 13 2277.207\nmSwimming.subset       10 2305.114\n```\n:::\n\n```{.r .cell-code}\n# With tank order on all data\nmOrder.Swimming <-lmer(Swimming ~ Tank + Time + Filter + Order.fac + (1|Fish), data = data) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n```{.r .cell-code}\nanova(mOrder.Swimming , ddf = \"Kenward-Roger\", type = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n          Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank      219905   54976     4 233.88  9.5912 3.376e-07 ***\nTime      337219  112406     3 228.04 19.6133 2.393e-11 ***\nFilter     71734   71734     1 152.69 12.5166 0.0005346 ***\nOrder.fac  68083   22694     3 230.47  3.9598 0.0088524 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n## Contrasts among Jar, Small, Medium and Large over Orders 1 to 4\nemmeans(mOrder.Swimming, ~ Tank , \n                       at = list(Tank = c(\"Jar\", \"Small\", \"Medium\", \"Large\"), \n                                 Order.fac = c(\"1\", \"2\", \"3\", \"4\"))) %>% \n  contrast(.,\n           list(jar_vs_small     = c(1,-1, 0, 0), \n                jar_vs_medium    = c(1, 0,-1, 0), \n                jar_vs_large     = c(1, 0, 0,-1),\n                small_vs_medium  = c(0, 1,-1, 0),\n                small_vs_large   = c(0, 1, 0,-1), \n                medium_vs_large  = c(0, 0, 1,-1)),\n           adjust = \"holm\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n contrast        estimate   SE  df t.ratio p.value\n jar_vs_small     -16.468 15.3 229  -1.074  0.8523\n jar_vs_medium    -17.203 17.7 240  -0.971  0.8523\n jar_vs_large     -92.070 17.4 239  -5.286  <.0001\n small_vs_medium   -0.735 17.3 240  -0.043  0.9661\n small_vs_large   -75.602 17.1 240  -4.413  0.0001\n medium_vs_large  -74.868 15.0 228  -4.995  <.0001\n\nResults are averaged over the levels of: Time, Filter, Order.fac \nDegrees-of-freedom method: kenward-roger \nP value adjustment: holm method for 6 tests \n```\n:::\n\n```{.r .cell-code}\n## Contrasts between Large (over Orders 1 to 4) and Barren\nemm1 <- emmeans(mOrder.Swimming, ~ Tank , \n                       at = list(Tank = c(\"Large\"), \n                                 Order.fac = c(\"1\", \"2\", \"3\", \"4\")))\nemm2 <- emmeans(mOrder.Swimming, ~ Tank , \n                       at = list(Tank = c(\"Barren\"), \n                                 Order.fac = c(\"5\")))\ncontrast(rbind(emm1,emm2), list(large_vs_barren= c(1,-1)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n contrast        estimate   SE  df t.ratio p.value\n large_vs_barren     53.4 15.3 229   3.494  0.0006\n\nResults are averaged over some or all of the levels of: Time, Filter, Order.fac \nDegrees-of-freedom method: kenward-roger \n```\n:::\n\n```{.r .cell-code}\n## Estimated means for Orders 1 to 4\nemm1 <- emmeans(mOrder.Swimming, ~ Order.fac, \n                       at = list(Order.fac = c(\"1\", \"2\", \"3\", \"4\")))\n\n# Without tank order on all data\nmSwimming <-lmer(Swimming ~ Tank + Time + Filter + (1|Fish), data = data) \n\nAIC(mOrder.Swimming,mSwimming)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                df      AIC\nmOrder.Swimming 14 2851.958\nmSwimming       11 2878.882\n```\n:::\n:::\n\n\nSignificant effect of tank order + The best model is the one with tank order (in terms of AIC) on the full dataset or dataset without Barren => Tank order needs to be included in the model... \n\nGood news:\n\n+ I found a way to calculate contrasts among Jar, Small, Medium and Large on the model with all data!\n+ I found a way to calculate the contrast between contrast Large (estimated across Orders 1 to 4) and Barren at Order 5.\n+ Still an effect of tank when tank order is included\n\n# Resting\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# with tank order\nmOrder.Resting <- lmer(Resting ~ Tank + Time + Filter + Order.fac + (1|Fish), data = data)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n```{.r .cell-code}\nanova(mOrder.Resting, ddf = \"Kenward-Roger\", type = 2) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n          Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank      493242  123311     4 232.15  9.9054 2.041e-07 ***\nTime      795993  265331     3 228.01 21.3145 3.308e-12 ***\nFilter         1       1     1 224.03  0.0001 0.9936214    \nOrder.fac 218417   72806     3 229.40  5.8486 0.0007258 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# without tank order\nmResting <- lmer(Resting ~ Tank + Time + Filter + (1|Fish), data = data) \n\nAIC(mOrder.Resting, mResting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               df      AIC\nmOrder.Resting 14 3047.644\nmResting       11 3082.241\n```\n:::\n:::\n\n\nIdem Swimming\n\n# Foraging\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmOrder.Foraging <- glmmTMB(Foraging.bin ~ Tank + Time + Filter + Order.fac + (1|Fish), data = data, family =binomial, control = glmmTMBControl(rank_check = \"adjust\")) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order.fac5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mOrder.Foraging)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Foraging.bin\n            Chisq Df Pr(>Chisq)    \nTank      31.4734  4  2.451e-06 ***\nTime       1.8543  3     0.6032    \nFilter     0.4113  1     0.5213    \nOrder.fac  4.5561  3     0.2073    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nmForaging <- glmmTMB(Foraging.bin ~ Tank + Time + Filter + (1|Fish), data = data, family =binomial)\n\nAIC(mOrder.Foraging,mForaging)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                df      AIC\nmOrder.Foraging 13 281.8794\nmForaging       10 280.6847\n```\n:::\n:::\n\n\nThe model is better without Tank order + no effect of tank order. Still a significant effect of Tank with Tank order in the model.\n\n# Nest building\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmOrder.Nesting <- glmmTMB(Nest.bin ~ Tank + Time + Filter + Order.fac + (1|Fish), data = data, family =binomial, control = glmmTMBControl(rank_check = \"adjust\")) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order.fac5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mOrder.Nesting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Nest.bin\n            Chisq Df Pr(>Chisq)    \nTank       8.6944  4  0.0692076 .  \nTime       7.3587  3  0.0613014 .  \nFilter    11.7652  1  0.0006035 ***\nOrder.fac  4.6506  3  0.1992406    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nmNesting <- glmmTMB(Nest.bin ~ Tank + Time + Filter + (1|Fish), data = data, family =binomial)\n\nAIC(mOrder.Nesting,mNesting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               df      AIC\nmOrder.Nesting 13 229.7846\nmNesting       10 228.6833\n```\n:::\n:::\n\n\nIdem Foraging, the model is better without Tank order + no effect of tank order. However, keeping Tank order removes the significant effect of Tank on Nest Building\n\n# Stereotypic Swimming\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmOrder.SS <- glmmTMB(SS.bin ~ Tank + Time + Filter + Order.fac + (1|Fish), data = data, family =binomial, control = glmmTMBControl(rank_check = \"adjust\")) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order.fac5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mOrder.SS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: SS.bin\n            Chisq Df Pr(>Chisq)    \nTank      22.3290  4  0.0001723 ***\nTime       3.1486  3  0.3692807    \nFilter     1.7487  1  0.1860451    \nOrder.fac  2.7610  3  0.4299628    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nmSS <- glmmTMB(SS.bin ~ Tank + Time + Filter + (1|Fish), data = data, family =binomial)\n\nAIC(mOrder.SS,mSS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          df      AIC\nmOrder.SS 13 208.9245\nmSS       10 205.7593\n```\n:::\n:::\n\n\nIdem Foraging",
    "supporting": [
      "Tank-order_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}