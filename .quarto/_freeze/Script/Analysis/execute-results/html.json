{
  "hash": "5d08578cce253c429bd8d05919e16967",
  "result": {
    "markdown": "---\ntitle: \"Code of the statistical analysis for the article 'Life Beyond A Jar: Effects of Tank Size and Enrichment on the Behaviour and Welfare of Siamese Fighting Fishes'\"\ndate: \"2024-07-25\"\nauthor: \"Juliette Tariel-Adam\"\nformat: \n   html:\n    embed-resources: true\n    self-contained-math: true\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk:\n    fig-align: center\n    out-width: \"100%\"\n---\n\n\n\n\nThe script contains the code of data transformation, analysis and graphs for the article \"Life Beyond A Jar: Effects of Tank Size and Enrichment on the Behaviour and Welfare of Siamese Fighting Fishes\" by Naomi Clark-Shen et al. It is in two versions: the raw R script in qmd format and the code output in html format. \n\nThe goal was to test the effect of tank enrichment and size on Siamese fish behaviour. The tanks Jar, Small, Medium and Large are compared among each other, and the tank Large and Barren between each other. Barren is not compared to Jar, Small or Medium because they differ by two factors: enrichment and size. \n\nOn the html version of the code, you fill find below a first row of tabs to click on (PCA, Swimming, etc) and for most of these tabs, a second row of tabs to click on (Distribution, Plot, etc).\n\n::: {.panel-tabset}\n\n# Data description\n\nAfter staying 3-7 days in a tank, the behaviour of all fish were scored by four 10-min trials in their tank. All trials occurred on the same day at 4 different times (7 am, 10 am, 2 pm, 6 pm). During the 10 min trial = 600 sec, the fish's behaviour was assigned to one of the 10 behaviours, meaning that the behaviours are mutually exclusive (for instance, a fish can't be scored as nest building and interacting with the surface at the same time): Resting, Swimming, Hovering, Sinking/Floating, Stereotypic swimming, Nest building, Foraging, Interation with surface, Out of view, Unsure. Unsure is not present in the raw dataset.\nOut.of.view is a bit special because it is not a behaviour and was not analysed.\nSinking/Floating was not analysed (see explanation in the PCA section).\n\n::: {.panel-tabset}\n\n## Basic description\n\nThe data has been inspected and corrected for data entry errors (sum of scored behaviours too low/high, column shifted, typos, inconsistent nb of observations per fish/time/tank...).\n\nEach row represents a trial. For each trial, there is:\n\n+ Fish: the fish tested\n+ Tank: in which tank the fish was\n+ Order: the tank order, i.e. whether it was the first, second, ..., fifth tank that the fish experienced.\n+ Time: time of the day at which the trial happened\n+ Filter: where there a filter in the tank\n+ Behavioural columns. The columns for the behaviours are the time spent doing the specific behaviour in seconds during the trial. Some behaviours (Forgaging, Hovering, Interaction.with.Surface, Stereotypic.swimming) have been trasnformed in binary variable (.bin). The columns .bins represents if the fish performed the specific behaviour at lest during one second during the trial or not. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Fish         Tank    Order        Time          Filter       Swimming    \n Elf    : 20   Jar   :48   1:52   7:00 AM :63   No-filter:180   Min.   :  0.0  \n Fairy  : 20   Small :52   2:52   10:00 AM:63   Filter   : 72   1st Qu.:133.9  \n Ghost  : 20   Medium:52   3:48   2:00 PM :63                   Median :224.8  \n Goblin : 20   Large :52   4:52   6:00 PM :63                   Mean   :224.6  \n Kinara : 20   Barren:48   5:48                                 3rd Qu.:309.2  \n Kraken : 20                                                    Max.   :486.8  \n (Other):132                                                                   \n    Resting          Hovering      Stereotypic.swimming Nest.building   \n Min.   :  0.00   Min.   :  0.00   Min.   :  0.00       Min.   :  0.00  \n 1st Qu.: 92.33   1st Qu.:  6.01   1st Qu.:  0.00       1st Qu.:  0.00  \n Median :190.99   Median : 23.71   Median :  0.00       Median :  0.00  \n Mean   :226.04   Mean   : 42.93   Mean   : 42.47       Mean   : 33.72  \n 3rd Qu.:354.97   3rd Qu.: 56.21   3rd Qu.: 20.58       3rd Qu.:  0.00  \n Max.   :600.00   Max.   :344.27   Max.   :549.00       Max.   :512.99  \n                                                                        \n    Foraging      Interation.with.surface Foraging.bin SS.bin    Hovering.bin\n Min.   :  0.00   Min.   :  0.000         No :168      No :172   No : 48     \n 1st Qu.:  0.00   1st Qu.:  0.000         Yes: 84      Yes: 80   Yes:204     \n Median :  0.00   Median :  1.545                                            \n Mean   :  7.83   Mean   : 15.331                                            \n 3rd Qu.:  7.80   3rd Qu.: 14.117                                            \n Max.   :125.28   Max.   :251.000                                            \n                                                                             \n Interacting.bin Nest.bin \n No :125         No :201  \n Yes:127         Yes: 51  \n                          \n                          \n                          \n                          \n                          \n```\n:::\n\n```{.r .cell-code}\n# Number of observations per fish per tank\ndata %>% group_by(Fish, Tank) %>%\n  summarise(n=n(), .groups = 'drop') %>%\n  spread(Tank,n) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 13 × 6\n   Fish            Jar Small Medium Large Barren\n   <fct>         <int> <int>  <int> <int>  <int>\n 1 Dragon           NA     4      4     4      4\n 2 Elf               4     4      4     4      4\n 3 Fairy             4     4      4     4      4\n 4 Ghost             4     4      4     4      4\n 5 Goblin            4     4      4     4      4\n 6 Kinara            4     4      4     4      4\n 7 Kraken            4     4      4     4      4\n 8 Merlion           4     4      4     4     NA\n 9 Naga              4     4      4     4      4\n10 Orange Pendek     4     4      4     4      4\n11 Pegasus           4     4      4     4      4\n12 Phoenix           4     4      4     4      4\n13 Wizard            4     4      4     4      4\n```\n:::\n\n```{.r .cell-code}\n# Number of observations per fish per time\ndata %>% group_by(Fish, Time) %>%\n  summarise(n=n(), .groups = 'drop') %>%\n  spread(Time,n) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 13 × 5\n   Fish          `7:00 AM` `10:00 AM` `2:00 PM` `6:00 PM`\n   <fct>             <int>      <int>     <int>     <int>\n 1 Dragon                4          4         4         4\n 2 Elf                   5          5         5         5\n 3 Fairy                 5          5         5         5\n 4 Ghost                 5          5         5         5\n 5 Goblin                5          5         5         5\n 6 Kinara                5          5         5         5\n 7 Kraken                5          5         5         5\n 8 Merlion               4          4         4         4\n 9 Naga                  5          5         5         5\n10 Orange Pendek         5          5         5         5\n11 Pegasus               5          5         5         5\n12 Phoenix               5          5         5         5\n13 Wizard                5          5         5         5\n```\n:::\n\n```{.r .cell-code}\n# Sum of all behaviours per trial\ndata3$total <- rowSums(dplyr::select(data3, beh.cols3)) \nsort(data3$total) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] 556.750 557.010 559.290 571.820 575.700 583.180 584.820 586.990 588.230\n [10] 588.970 592.550 592.810 592.910 593.320 594.830 595.190 595.330 595.560\n [19] 595.760 595.990 596.190 596.270 596.290 596.500 596.600 596.890 596.910\n [28] 597.288 597.370 597.490 597.610 597.700 597.770 597.830 597.890 598.070\n [37] 598.350 598.470 598.480 598.500 598.640 598.730 598.750 599.060 599.560\n [46] 599.580 599.640 599.720 599.810 600.000 600.000 600.040 600.090 600.290\n [55] 600.400 600.410 600.440 600.610 600.620 600.750 600.780 600.880 600.930\n [64] 601.030 601.050 601.070 601.110 601.300 601.360 601.380 601.470 601.550\n [73] 601.560 601.570 601.630 601.650 601.650 601.670 601.680 601.710 601.750\n [82] 601.770 601.810 601.820 601.820 601.860 601.870 601.960 601.970 602.050\n [91] 602.050 602.060 602.060 602.090 602.090 602.110 602.130 602.160 602.160\n[100] 602.170 602.210 602.220 602.370 602.430 602.430 602.450 602.470 602.620\n[109] 602.620 602.640 602.660 602.670 602.710 602.740 602.760 602.760 602.790\n[118] 602.790 602.870 602.900 602.920 602.960 602.970 602.990 603.000 603.010\n[127] 603.100 603.120 603.120 603.170 603.190 603.220 603.220 603.250 603.290\n[136] 603.290 603.310 603.360 603.370 603.380 603.390 603.400 603.410 603.450\n[145] 603.490 603.520 603.650 603.670 603.690 603.690 603.700 603.720 603.730\n[154] 603.800 603.820 603.840 603.880 603.880 603.890 603.910 603.940 604.010\n[163] 604.010 604.020 604.040 604.110 604.120 604.130 604.130 604.190 604.200\n[172] 604.210 604.230 604.260 604.300 604.300 604.310 604.320 604.350 604.360\n[181] 604.360 604.380 604.380 604.400 604.410 604.410 604.430 604.470 604.520\n[190] 604.550 604.590 604.610 604.640 604.660 604.660 604.670 604.670 604.680\n[199] 604.690 604.710 604.720 604.730 604.750 604.780 604.790 604.810 604.870\n[208] 604.890 604.900 604.930 604.930 604.950 604.960 605.000 605.000 605.010\n[217] 605.030 605.060 605.280 605.290 605.310 605.330 605.470 605.470 605.570\n[226] 605.650 605.780 605.830 605.910 605.980 606.000 606.150 606.360 607.020\n[235] 607.170 607.680 607.700 608.260 608.540 608.810 609.200 609.340 609.450\n[244] 610.030 610.130 612.490 612.530 614.340 614.850 616.970 622.480 624.680\n```\n:::\n:::\n\n\nThe sum of all behaviours is not exactly 600 sec (as Unsure is not in the dataset).\n\n\n## Plots\n\nThe mean value over multiple trials is plotted to only have one value per tank and per behaviour. \n\n\n::: {.cell .column-page layout-align=\"center\"}\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-2.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-3.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-4.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-5.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-6.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-3-7.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Filter\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# nb of fish had a filter in their tank\ntable(data$Tank, data$Filter)/4 \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        \n         No-filter Filter\n  Jar           12      0\n  Small         13      0\n  Medium         7      6\n  Large          7      6\n  Barren         6      6\n```\n:::\n\n```{.r .cell-code}\n# nb of times each fish had a filter in their tank\ntable(data$Fish, data$Filter)/4 \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               \n                No-filter Filter\n  Dragon                1      3\n  Elf                   5      0\n  Fairy                 2      3\n  Ghost                 2      3\n  Goblin                5      0\n  Kinara                5      0\n  Kraken                2      3\n  Merlion               4      0\n  Naga                  5      0\n  Orange Pendek         5      0\n  Pegasus               5      0\n  Phoenix               2      3\n  Wizard                2      3\n```\n:::\n\n```{.r .cell-code}\nplot1(\"Filter\", main = data3, beh_cols = beh.cols3, palette = palette.beh3)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThere have never been a filter in Jar or Small. Some fish never had a filter in their tank. Filter needs to be included in all models as a control variable.\n\n::: \n\n# PCA\n\nWe run a PCA in order to:\n\n+ Try to reduce the number of variables to analyse \n+ Determine which behaviours were important to explain the variability between trials\n+ See correlations between behaviours\n\nThe PCA did not help reduce the number of variables to analyse (see Analysis_PCA.html for more explanation) so the behaviours were analysed separately with linear models. The advantage of separate linear models compared to the PCA is the possibility to quantitatively interpret the differences between tanks.\n\nEven if we did not use PCA for further analysis, the first 4 components are plotted below, which explained 71% of variance in the data, to show the important variables and the correlations between variables. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(pca, choix = \"var\") + labs(title = NULL)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot(pca, choix = \"var\", axes = c(3,4)) + labs(title = NULL)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-5-2.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Contribution to each principal component\nround(pca$var$cos2,2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                        Dim.1 Dim.2 Dim.3 Dim.4\nSwimming                 0.68  0.01  0.10  0.00\nResting                  0.80  0.00  0.14  0.04\nHovering                 0.00  0.51  0.04  0.11\nStereotypic.swimming     0.06  0.52  0.13  0.23\nNest.building            0.01  0.06  0.57  0.19\nForaging                 0.32  0.01  0.16  0.18\nInteration.with.surface  0.09  0.16  0.05  0.21\nSinking.Floating         0.06  0.00  0.03  0.18\n```\n:::\n\n```{.r .cell-code}\n# Extent to which each behavioural type contributes to the total variance explained by the first 3 components\nrowSums(pca$var$contrib[,1:3])/3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Swimming                 Resting                Hovering \n              13.946992               17.017016               14.360858 \n   Stereotypic.swimming           Nest.building                Foraging \n              18.372673               17.241361               10.134302 \nInteration.with.surface        Sinking.Floating \n               7.115428                1.811372 \n```\n:::\n:::\n\n\n+ The 1st PCA component was driven by Resting (cos2 = 0.8), Swimming (0.7) and Foraging (0.3). Swimming and Foraging opposite to Resting. This first component could be interpret as \"activity\". If a fish spent a lot of time swimming and foraging during a trial, it was very little resting. This first component explained 25% of the variance in the data (as a reminder, the data is the time spent performing the different types of behaviour). So 1 quarter of the variance is a matter of activity. Keep in mind for the rest of the analyses that these behavioural types are correlated. \n\n+ The 2nd PCA component was driven by Hovering (cos2 = 0.5) and Stereotypic.swimming (0.5), and a bit by Interaction with surface (0.16). Hovering and Interacting.with.Surface opposite to Stereotypic.swimming. If the fish spent a lot of time hovering (and interacting with the surface), it was very little stereotypic swimming.\n\n+ The 3rd PCA component was driven mainly by Nest building (cos2 = 0.6), and a bit by Foraging (0.16), Resting (0.14) and Stereotypic Swimming (0.13). Foraging and Resting opposite to Nest building and Stereotypic Swimming. If a fish spent time foraging and resting in a trial, it was little nest building and stereotypic swimming. This makes sense, it a fish is building a nest,it is an important task and needs to be finished, so it is not scattering its time with other activities. The apparent correlation between nest building and stereotypic swimming could be due to Jar where fish in this tank rarely engaged in nest building or stereotypic swimming. \n\n+ The 4th PCA component was not easily interpretable = not easily linked to the initial behavioural variables.\n\nSinking/Floating contributed almost nothing to the PCA (1.8%) + did not correlate strongly with any of the component. Sinking/Floating was not important to explain the variability between trials. We did not further analyse this behaviour.\n\n# Swimming\n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Swimming)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Plot \n\nThe first plot is to see the trend by tank. Big red dots is for the overall mean  by tank. Small black points are raw data = swimming time of each trial. \n\nThe second plot is to see the trend by fish and by tank. The dashed black line is means by tank. The other lines are the means for each fish by tank. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_var(data, \"Swimming\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot_var_fish(data, \"Swimming\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-8-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Linear model \n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmSwimming <- lmer(Swimming ~ Tank + Time + Filter + Order + (1|Fish), data = data)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n```{.r .cell-code}\n# Error message due to the fact that all trials with Tank = Barren are also Order = \"5\"\nanova(mSwimming, ddf = \"Kenward-Roger\", type = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n       Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank   219905   54976     4 233.88  9.5912 3.376e-07 ***\nTime   337219  112406     3 228.04 19.6133 2.393e-11 ***\nFilter  71734   71734     1 152.69 12.5166 0.0005346 ***\nOrder   68083   22694     3 230.47  3.9598 0.0088524 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size(mSwimming)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1    jar_vs_small      -16 15.3 229   -1.07   0.852      -57       24\n2   jar_vs_medium      -17 17.7 240   -0.97   0.852      -64       30\n3    jar_vs_large      -92 17.4 239   -5.29  <0.001     -138      -46\n4 small_vs_medium       -1 17.3 240   -0.04   0.966      -47       45\n5  small_vs_large      -76 17.1 240   -4.41  <0.001     -121      -30\n6 medium_vs_large      -75 15.0 228   -5.00  <0.001     -115      -35\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich(mSwimming)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1 large_vs_barren       53 15.3 229    3.49  <0.001       23       84\n```\n:::\n\n```{.r .cell-code}\n# estimated means of time spent swimming depending on:\n## time of day\nemmeans(mSwimming, ~ Time)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Time     emmean   SE   df lower.CL upper.CL\n 7:00 AM     298 15.1 27.2      267      329\n 10:00 AM    240 15.1 27.2      209      271\n 2:00 PM     204 15.1 27.2      173      235\n 6:00 PM     214 15.1 27.2      183      245\n\nResults are averaged over the levels of: Tank, Filter, Order \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n:::\n\n```{.r .cell-code}\n## filter\nemmeans(mSwimming, ~ Filter)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Filter    emmean   SE   df lower.CL upper.CL\n No-filter    206 13.2 15.1      178      234\n Filter       272 18.0 34.1      236      309\n\nResults are averaged over the levels of: Tank, Time, Order \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n:::\n\n```{.r .cell-code}\n## order\nrbind(emmeans(mSwimming, ~ Order, at = list(Tank = c(\"Jar\", \"Small\", \"Medium\", \"Large\"),Order = c(\"1\", \"2\", \"3\", \"4\"))),\n      emmeans(mSwimming, ~ Order, at = list(Tank = c(\"Barren\"),Order = \"5\"))) # tank order\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Order emmean   SE   df lower.CL upper.CL\n 1        225 16.8 36.6      180      271\n 2        256 15.7 31.3      213      299\n 3        256 16.2 35.5      212      301\n 4        213 16.3 34.2      169      258\n 5        245 15.6 31.8      202      288\n\nResults are averaged over some or all of the levels of: Tank, Time, Filter \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nConf-level adjustment: bonferroni method for 5 estimates \n```\n:::\n:::\n\n\nEffect of Tank, Time, Filter and Order! \n\n+ Tank. Large swam significantly more time than Jar, Small and Medium. Fish in Large swan 92 sec [CI 46, 138] more than Jar (over a 600 sec trial) for example. In addition,  fish in Large swam significantly more time than fish in Barren. \n+ Time. It seems that fish swam more in the morning than in the afternoon, especially at 7 am.\n+ Filter. Fish swam more with a filter in their tank.\n+ Order. It seems that fish swam more in their 2nd and 3rd tank.\n\nEffect of Barren or tank order 5? The effect size of Tank (shown by the Sum Sq) is three times more than the effect size of Order. Max difference between orders 1-4 is 43 sec. Difference between Large and Barren/5 is 53. Effect of tank is stronger on time spent swimming, so it is likely the diff between Large and Barren/5 is due (at least party) to Tank.\n\n## Between-fish diff\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Uncomment the 2 lines below if running the script for the first time\n## rpt.swimming <- rpt(Swimming ~ Tank + Time + Filter + Order + (1|Fish), grname = \"Fish\", data = data, datatype = \"Gaussian\", nboot = 10000, npermut = 0)\n## save(rpt.swimming, file = \"Script/Repeatability rptR output/rpt.swimming\")\nbase::load(\"Script/Repeatability rptR output/rpt.swimming\")\nsummary(rpt.swimming)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nRepeatability estimation using the lmm method\n\nCall = rpt(formula = Swimming ~ Tank + Time + Filter + Order + (1 | Fish), grname = \"Fish\", data = data, datatype = \"Gaussian\", nboot = 10000, npermut = 0)\n\nData: 252 observations\n----------------------------------------\n\nFish (13 groups)\n\nRepeatability estimation overview: \n      R     SE   2.5%  97.5% P_permut  LRT_P\n  0.217 0.0823 0.0613  0.377       NA      0\n\nBootstrapping and Permutation test: \n            N   Mean Median   2.5%  97.5%\nboot    10000   0.21  0.206 0.0613  0.377\npermut      1     NA     NA     NA     NA\n\nLikelihood ratio test: \nlogLik full model = -1453.809\nlogLik red. model = -1470.599\nD  = 33.6, df = 1, P = 3.42e-09\n\n----------------------------------------\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mSwimming),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Groups   Name        Variance\n Fish     (Intercept) 1590    \n Residual             5731    \n```\n:::\n:::\n\n\nLikelihood ratio test indicates a statistically significant random effect. Meaning that fish behaved differently among each others in terms of swimming. But the repeatability is quite low (0.2 [95% CI 0.06, 0.37]). \n\n## Diagnosis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlm_diagnosis(mSwimming)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"check constant variance over fitted values\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-11-2.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality of Swimming\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-11-3.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality random residuals\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-11-4.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-11-5.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good.\n\n:::\n\n# Resting\n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Resting)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntable(data$Resting==0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n  241    11 \n```\n:::\n:::\n\n\nOnly 11 trials where the fish did not rest at all. \n\n## Plot \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_var(data, \"Resting\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot_var_fish(data, \"Resting\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-13-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Linear model \n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmResting <- lmer(Resting ~ Tank + Time + Filter + Order + (1|Fish), data = data)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n```{.r .cell-code}\nanova(mResting, ddf = \"Kenward-Roger\", type = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n       Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank   493242  123311     4 232.15  9.9054 2.041e-07 ***\nTime   795993  265331     3 228.01 21.3145 3.308e-12 ***\nFilter      1       1     1 224.03  0.0001 0.9936214    \nOrder  218417   72806     3 229.40  5.8486 0.0007258 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size(mResting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1    jar_vs_small       50 22.6 228    2.19   0.089      -11      110\n2   jar_vs_medium        5 26.4 236    0.20   0.842      -65       75\n3    jar_vs_large      109 25.9 236    4.21  <0.001       40      178\n4 small_vs_medium      -44 25.8 237   -1.72   0.174     -113       24\n5  small_vs_large       60 25.5 237    2.34   0.081       -8      128\n6 medium_vs_large      104 22.1 228    4.70  <0.001       45      163\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich(mResting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1 large_vs_barren        4 22.5 228    0.17   0.865      -41       48\n```\n:::\n\n```{.r .cell-code}\n# estimated means of time spent resting depending on:\n## time of day\nemmeans(mResting, ~ Time)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Time     emmean   SE   df lower.CL upper.CL\n 7:00 AM     146 29.9 18.5     82.9      208\n 10:00 AM    203 29.9 18.5    140.7      266\n 2:00 PM     263 29.9 18.5    200.9      326\n 6:00 PM     291 29.9 18.5    228.5      354\n\nResults are averaged over the levels of: Tank, Filter, Order \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n:::\n\n```{.r .cell-code}\n## order\nrbind(emmeans(mResting, ~ Order, at = list(Tank = c(\"Jar\", \"Small\", \"Medium\", \"Large\"),Order = c(\"1\", \"2\", \"3\", \"4\"))),\n      emmeans(mResting, ~ Order, at = list(Tank = c(\"Barren\"),Order = \"5\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Order emmean   SE   df lower.CL upper.CL\n 1        251 31.8 23.1    162.2      341\n 2        204 30.4 20.0    117.8      291\n 3        215 31.1 21.7    127.4      303\n 4        290 31.2 21.7    202.2      378\n 5        168 30.3 19.9     81.9      255\n\nResults are averaged over some or all of the levels of: Tank, Time, Filter \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nConf-level adjustment: bonferroni method for 5 estimates \n```\n:::\n:::\n\n\nEffect of Tank, Time and Order.\n\n+ Tank. Large rested significantly less time than Jar and Medium (almost significant for Small). This is in line with the PCA and the results of Swimming: Fish that spent time swimming spent less time resting. Fish in Large were overall more active. No significant difference between Large and Barren. \n+ Time. Fish rested less time in the morning, especially at 7 am. In line with the PCA and the results of Swimming.\n+ Order. It seems that fish rested more in their 1st and 4th tank.\n\n## Between-fish diff\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Uncomment the 2 lines below if running the script for the first time\n## rpt.resting <- rpt(Resting ~ Tank + Time + Filter + Order + (1|Fish), grname = \"Fish\", data = data, datatype = \"Gaussian\", nboot = 10000, npermut = 0)\n## save(rpt.resting, file = \"Script/Repeatability rptR output/rpt.resting\")\nbase::load(\"Script/Repeatability rptR output/rpt.resting\")\nsummary(rpt.resting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nRepeatability estimation using the lmm method\n\nCall = rpt(formula = Resting ~ Tank + Time + Filter + Order + (1 | Fish), grname = \"Fish\", data = data, datatype = \"Gaussian\", nboot = 10000, npermut = 0)\n\nData: 252 observations\n----------------------------------------\n\nFish (13 groups)\n\nRepeatability estimation overview: \n      R     SE   2.5%  97.5% P_permut  LRT_P\n  0.406  0.106  0.177  0.588       NA      0\n\nBootstrapping and Permutation test: \n            N   Mean Median   2.5%  97.5%\nboot    10000   0.39  0.392  0.177  0.588\npermut      1     NA     NA     NA     NA\n\nLikelihood ratio test: \nlogLik full model = -1556.775\nlogLik red. model = -1595.284\nD  = 77, df = 1, P = 8.48e-19\n\n----------------------------------------\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mResting),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Groups   Name        Variance\n Fish     (Intercept)  8519   \n Residual             12448   \n```\n:::\n:::\n\n\nLikelihood ratio test indicates a statistically significant random effect. Meaning that fish behaved differently among each others in terms of swimming. The repeatability is good 0.4 [95% CI 0.16, 0.58].\n\n## Diagnosis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlm_diagnosis(mResting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"check constant variance over fitted values\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-16-2.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality of Resting\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-16-3.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality random residuals\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-16-4.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-16-5.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good.\n\n:::\n\n# Resting place\n\n::: {.panel-tabset}\n\nAnalysis only for Small, Medium and Large which have furnishings. We concatenate the resting places Filter, Plants and Hideout barrel into one category Furnishings to be able to compare resting places for all trials (not all trials occurred with a filter or a hideout barrel inside the tanl). \n\nThe total resting time was different for each trial -> we can't use directly the raw resting time at each place.\n\nWe are using a multinomial regression model: extension of the binomial logit model to more than two categories. We have then three categories:\n\n+ Floor\n+ Water surface\n+ Furnishings (Plants, Barrel, Filter)\n\nOur three response variables are the numbers of seconds resting at these 3 categories for each trial. \n\n1. \\# sec resting of the floor during the trial\n2. \\# sec resting at the water surface of the floor during the trial\n3. \\# sec resting of furnishings of the floor during the trial.\n\nThey sum up to the total # sec resting during the trial. \n\n## Data description\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummary(data_RP %>% dplyr::select(Floor:Furn.perc))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Floor        Water.surface      Furnishings     Total.trial   \n Min.   :  0.00   Min.   :  0.000   Min.   :  0.0   Min.   :  5.0  \n 1st Qu.: 26.25   1st Qu.:  0.000   1st Qu.: 20.5   1st Qu.:101.0  \n Median : 61.00   Median :  0.000   Median : 74.0   Median :200.0  \n Mean   :101.72   Mean   :  6.395   Mean   :124.1   Mean   :232.2  \n 3rd Qu.:150.00   3rd Qu.:  0.000   3rd Qu.:167.8   3rd Qu.:339.5  \n Max.   :578.00   Max.   :150.000   Max.   :547.0   Max.   :584.0  \n   Floor.perc      Surface.perc       Furn.perc     \n Min.   :0.0000   Min.   :0.00000   Min.   :0.0000  \n 1st Qu.:0.1608   1st Qu.:0.00000   1st Qu.:0.1841  \n Median :0.5053   Median :0.00000   Median :0.4480  \n Mean   :0.4901   Mean   :0.04063   Mean   :0.4692  \n 3rd Qu.:0.7898   3rd Qu.:0.00000   3rd Qu.:0.8207  \n Max.   :1.0000   Max.   :1.00000   Max.   :1.0000  \n```\n:::\n\n```{.r .cell-code}\n# number of zeros (no resting at this place during the trial), N (total nb of trials) and NAs (NAs for filter and barrel when no filter or barrel in the tank)\ncount_zeros_and_nas <- function(df) {\n  result <- data.frame(\n    Zeros = sapply(df, function(x) sum(x == 0, na.rm = TRUE)),\n    N = sapply(df, function(x) sum(!is.na(x))),\n    NAs = sapply(df, function(x) sum(is.na(x)))\n  )\n  return(result)}\ndata_RP %>% dplyr::select(Floor, Water.surface, Furnishings) %>% \n  count_zeros_and_nas(.)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Zeros   N NAs\nFloor            17 152   0\nWater.surface   116 152   0\nFurnishings      22 152   0\n```\n:::\n:::\n\n\nOn average, fish spent 49% of their resting time on the floor, 47% on furnishings and 4% on the water surface. Out of 152 trials during which fish rested, they avoided resting on the floor in 17 trials, on furnishings in 22 trials, and on the water surface in 116 trials.\n\n### In Large tank with all resting places\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata_RP2 %>% filter(Tank == \"Large\") %>%  dplyr::select(Floor:Barrel.perc, -filter) %>% \n  summary() \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Floor        Water.surface        Plants           Barrel      \n Min.   :  0.00   Min.   : 0.000   Min.   :  0.00   Min.   :  0.00  \n 1st Qu.: 12.64   1st Qu.: 0.000   1st Qu.:  5.72   1st Qu.:  0.00  \n Median : 45.45   Median : 0.000   Median : 14.26   Median : 24.47  \n Mean   : 71.58   Mean   : 7.754   Mean   : 30.98   Mean   : 55.75  \n 3rd Qu.: 96.82   3rd Qu.: 0.000   3rd Qu.: 42.40   3rd Qu.: 80.92  \n Max.   :504.37   Max.   :80.830   Max.   :188.09   Max.   :370.19  \n  Total.trial       Floor.perc      Surface.perc     Plants.perc     \n Min.   :  4.98   Min.   :0.0000   Min.   :0.0000   Min.   :0.00000  \n 1st Qu.: 84.95   1st Qu.:0.1388   1st Qu.:0.0000   1st Qu.:0.02278  \n Median :141.67   Median :0.5021   Median :0.0000   Median :0.12334  \n Mean   :166.11   Mean   :0.4592   Mean   :0.0374   Mean   :0.21036  \n 3rd Qu.:210.66   3rd Qu.:0.7644   3rd Qu.:0.0000   3rd Qu.:0.23330  \n Max.   :533.98   Max.   :1.0000   Max.   :0.5424   Max.   :1.00000  \n  Barrel.perc    \n Min.   :0.0000  \n 1st Qu.:0.0000  \n Median :0.1727  \n Mean   :0.2929  \n 3rd Qu.:0.5695  \n Max.   :0.9456  \n```\n:::\n\n```{.r .cell-code}\ndata_RP2 %>%  filter(Tank == \"Large\") %>% \n  pivot_longer(cols = Floor:Barrel, \n                        names_to = \"place\") %>% # remove filter because only zeros besides one trial\nggplot(., aes(value, fill = place)) +\n  geom_density(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nIn Large, they rested 46% on the floor, 29% in or on the hideout barrel, 21% on plants and 4% on the water. \n\n### Filter\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ndata_RP2 %>% dplyr::select(filter, filter.perc) %>% summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     filter         filter.perc     \n Min.   :0.00000   Min.   :0.00000  \n 1st Qu.:0.00000   1st Qu.:0.00000  \n Median :0.00000   Median :0.00000  \n Mean   :0.05289   Mean   :0.00019  \n 3rd Qu.:0.00000   3rd Qu.:0.00000  \n Max.   :2.38000   Max.   :0.00874  \n NA's   :107       NA's   :107      \n```\n:::\n\n```{.r .cell-code}\ndata_RP2 %>% dplyr::select(filter) %>% \n  count_zeros_and_nas(.)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Zeros  N NAs\nfilter    44 45 107\n```\n:::\n:::\n\n\nOut of 45 trials with a filter inside the tank, the fish avoided resting on the filter during 44 trials so almost of all them.\n\n## Analysis \n\nTo run the multinomial regression model, we have to account for the fact that each second is not independant from each other. Normally each second should be an independent experimental unit leading to a success or a failure (like in a classic binomial distribution). We included a \"trial\" random intercept to account for this non-independence between seconds of the same trial.\n\nWe included an \"ExpSetting\" random intercept including Tank, Order, Time and Filter. Reason for this is that otherwise the difference between water.surface vs floor or furnishings vs floor is done for every level of Tank, Order, Time and Filter. It is like asking the questions \"does the difference between water.surface and floor is significant in the large tank, in the medium, in the small tank, in a tank with no filter, etc. This was way too many tests and not tailor to our question: what resting place do fish prefer?\n\nIn the summary, the Estimate of the (Intercept) for Water.surface vs Floor is equal to $log(\\frac{P_{\\text{resting on the water surface}}}{P_{\\text{resting on the floor}}})$\n\nSame for the contrasts between estimated means.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# understanding ExpSetting (Tank:Order:Filter:Time) by showing all levels of ExpSetting\nunique(data_RP$ExpSetting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] Small2No-filter7:00 AM   Small2No-filter10:00 AM  Small2No-filter2:00 PM  \n [4] Small2No-filter6:00 PM   Medium4Filter7:00 AM     Medium4Filter10:00 AM   \n [7] Medium4Filter2:00 PM     Medium4Filter6:00 PM     Large1Filter7:00 AM     \n[10] Large1Filter10:00 AM     Large1Filter2:00 PM      Large1Filter6:00 PM     \n[13] Medium4No-filter7:00 AM  Medium4No-filter10:00 AM Medium4No-filter2:00 PM \n[16] Medium4No-filter6:00 PM  Large1No-filter7:00 AM   Large1No-filter10:00 AM \n[19] Large1No-filter2:00 PM   Large1No-filter6:00 PM   Small1No-filter7:00 AM  \n[22] Small1No-filter10:00 AM  Small1No-filter2:00 PM   Small1No-filter6:00 PM  \n[25] Medium3Filter7:00 AM     Medium3Filter10:00 AM    Medium3Filter2:00 PM    \n[28] Medium3Filter6:00 PM     Large2Filter7:00 AM      Large2Filter10:00 AM    \n[31] Large2Filter2:00 PM      Large2Filter6:00 PM      Medium3No-filter7:00 AM \n[34] Medium3No-filter10:00 AM Medium3No-filter2:00 PM  Medium3No-filter6:00 PM \n[37] Large2No-filter7:00 AM   Large2No-filter10:00 AM  Large2No-filter2:00 PM  \n[40] Large2No-filter6:00 PM   Small4No-filter7:00 AM   Small4No-filter10:00 AM \n[43] Small4No-filter2:00 PM   Small4No-filter6:00 PM   Medium1No-filter7:00 AM \n[46] Medium1No-filter10:00 AM Medium1No-filter2:00 PM  Medium1No-filter6:00 PM \n[49] Large3No-filter7:00 AM   Large3No-filter10:00 AM  Large3No-filter2:00 PM  \n[52] Large3No-filter6:00 PM   Small3No-filter7:00 AM   Small3No-filter10:00 AM \n[55] Small3No-filter2:00 PM   Small3No-filter6:00 PM   Medium2Filter7:00 AM    \n[58] Medium2Filter10:00 AM    Medium2Filter2:00 PM     Medium2Filter6:00 PM    \n[61] Large4Filter7:00 AM      Large4Filter10:00 AM     Large4Filter2:00 PM     \n[64] Large4Filter6:00 PM      Medium2No-filter7:00 AM  Medium2No-filter10:00 AM\n[67] Medium2No-filter2:00 PM  Medium2No-filter6:00 PM  Large4No-filter7:00 AM  \n[70] Large4No-filter10:00 AM  Large4No-filter2:00 PM   Large4No-filter6:00 PM  \n[73] Medium1Filter7:00 AM     Medium1Filter10:00 AM    Medium1Filter2:00 PM    \n[76] Medium1Filter6:00 PM     Large3Filter7:00 AM      Large3Filter10:00 AM    \n[79] Large3Filter2:00 PM      Large3Filter6:00 PM     \n80 Levels: Large1Filter10:00 AM Large1Filter2:00 PM ... Small4No-filter7:00 AM\n```\n:::\n\n```{.r .cell-code}\n# running the model\nmRP <- mblogit(cbind(Floor, Furnishings, Water.surface) ~ 1, random = list(~1|Fish,~1|trial, ~1|ExpSetting), data = data_RP)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Inner iterations did not coverge - nlminb message: false convergence\n(8)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nIteration 1 - deviance = 1385.262 - criterion = 0.4307748\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Inner iterations did not coverge - nlminb message: false convergence\n(8)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nIteration 2 - deviance = 1335.611 - criterion = 0.006520191\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Inner iterations did not coverge - nlminb message: false convergence\n(8)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nIteration 3 - deviance = 1300.461 - criterion = 0.001146697\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Inner iterations did not coverge - nlminb message: false convergence\n(8)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nIteration 4 - deviance = 1288.201 - criterion = 1.135005e-05\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Inner iterations did not coverge - nlminb message: false convergence\n(8)\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nIteration 5 - deviance = 1287.197 - criterion = 9.279535e-10\nconverged\n```\n:::\n\n```{.r .cell-code}\nsummary(mRP)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nmblogit(formula = cbind(Floor, Furnishings, Water.surface) ~ \n    1, data = data_RP, random = list(~1 | Fish, ~1 | trial, ~1 | \n    ExpSetting))\n\nEquation for Furnishings vs Floor:\n            Estimate Std. Error z value Pr(>|z|)\n(Intercept) -0.04398    0.33767   -0.13    0.896\n\nEquation for Water.surface vs Floor:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  -4.6274     0.3647  -12.69   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Co-)Variances:\nGrouping level: Fish \n                Estimate          Std.Err.       \nFurnishings~1    0.5890           0.09622        \nWater.surface~1 -0.1935  0.4862   0.07143 0.06196\n\nGrouping level: trial \n                Estimate      Std.Err.   \nFurnishings~1   8.929         4.749      \nWater.surface~1 4.515 8.385   3.200 2.543\n\nGrouping level: ExpSetting \n                Estimate            Std.Err.         \nFurnishings~1    0.40497            0.008813         \nWater.surface~1 -0.01979  0.39464   0.006058 0.008123\n\nApproximate residual deviance: 1287 \nNumber of Fisher scoring iterations:  5\nNumber of observations\n  Groups by Fish: 13\n  Groups by trial: 152\n  Groups by ExpSetting: 80\n  Individual observations:  152\n```\n:::\n\n```{.r .cell-code}\n# Contrasts\n## cbind1 = Floor, cbind2 = Furnishings, cbind3 = Water.surface\nemmeans(mRP, pairwise~cbind, mode = \"latent\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$emmeans\n cbind emmean    SE  df asymp.LCL asymp.UCL\n     1   1.56 0.176 Inf      1.21      1.90\n     2   1.51 0.242 Inf      1.04      1.99\n     3  -3.07 0.255 Inf     -3.57     -2.57\n\nResults are given on the log (not the response) scale. \nConfidence level used: 0.95 \n\n$contrasts\n contrast        estimate    SE  df z.ratio p.value\n cbind1 - cbind2    0.044 0.338 Inf   0.130  0.9907\n cbind1 - cbind3    4.627 0.365 Inf  12.688  <.0001\n cbind2 - cbind3    4.583 0.464 Inf   9.868  <.0001\n\nResults are given on the log (not the response) scale. \nP value adjustment: tukey method for comparing a family of 3 estimates \n```\n:::\n\n```{.r .cell-code}\n# Diagnostic normality of random residuals\n## Fish\nqqnorm(mRP$random.effects[[1]])\nqqline(mRP$random.effects[[1]])\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n## trial\nqqnorm(mRP$random.effects[[2]])\nqqline(mRP$random.effects[[2]])\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-20-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n## ExpSetting\nqqnorm(mRP$random.effects[[3]])\nqqline(mRP$random.effects[[3]])\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-20-3.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n\n# Foraging\n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Foraging)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-21-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntable(data$Foraging==0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n   84   168 \n```\n:::\n\n```{.r .cell-code}\ndescdist(data$Foraging, boot = 1000, print = FALSE)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-21-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe data are clearly not following a normal distribution. It seems that a beta distribution could suit but foraging is not a continuous variable ranging from 0 to 1. Foraging has thus been analysed as a binary variable: 1 if fish spent time foraging during this trial, 0 otherwise.\n\nThere were 168 trials (out of 252) during which no foraging happened.\n\n## Plot \n\nThe plots are in percentage of trials during which the fish foraged over the total number of trials.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_var_binary(data, \"Foraging.bin\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-22-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot_var_binary_fish(data, \"Foraging.bin\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-22-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Generalised linear model \n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmForaging <- glmmTMB(Foraging.bin ~ Tank + Time + Filter + Order + (1|Fish), data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mForaging)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Foraging.bin\n         Chisq Df Pr(>Chisq)    \nTank   31.4734  4  2.451e-06 ***\nTime    1.8543  3     0.6032    \nFilter  0.4113  1     0.5213    \nOrder   4.5561  3     0.2073    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size_bin(mForaging)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1    jar_vs_small       2.63 1.57 Inf    1    1.61   0.214     0.541    12.763\n2   jar_vs_medium       0.38 0.24 Inf    1   -1.53   0.214     0.074     1.995\n3    jar_vs_large       0.09 0.06 Inf    1   -3.71   0.001     0.015     0.493\n4 small_vs_medium       0.15 0.10 Inf    1   -2.80   0.015     0.024     0.896\n5  small_vs_large       0.03 0.02 Inf    1   -4.56  <0.001     0.005     0.237\n6 medium_vs_large       0.23 0.11 Inf    1   -3.02   0.010     0.062     0.827\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich_bin(mForaging)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1 large_vs_barren      15.75 8.76 Inf    1    4.95  <0.001     5.289    46.879\n```\n:::\n\n```{.r .cell-code}\n# example of differences between Jar and Large\n## Contrast estimate\n1/0.09\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 11.11111\n```\n:::\n\n```{.r .cell-code}\n## Upper CI\n1/0.015\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 66.66667\n```\n:::\n\n```{.r .cell-code}\n## Lower CI\n1/0.493\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.028398\n```\n:::\n:::\n\n\nEffect of Tank. \n\nAs a reminder, an odds.ratio < 1 between tank X vs tank Y means the probability of foraging during a trial in tank X is smaller that the probability of foraging during a trial in tank Y. An odd ratio for instance of 0.2 means that a fish is (1 / 0.2) = five times more likely to forage during a trial in tank Y than in Tank X. If we imagine 5 trials, fish will forage on average during 1 trial out of 5 in Tank X whereas fish will forage on average during 5 trials out of 5 in Tank Y. \n\n+ Tank. Fish were more likely to forage during a trial in Large compared to Jar, Small and Medium. Again in accordance with the PCA and the results of Swimming and Resting. Fish in Large were on average 11 times [CI 2, 67] more likely to forage during a trial than fish in Jar for example. In addition, fish were more likely to forage during a trial in Large than Barren. In accordance with the PCA and the results of Swimming. This time, there was also a significant difference between small and medium unlike Resting.\n\n## Between-fish diff\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrpt.foraging <- rpt(Foraging.bin ~ Tank + Time + Filter + Order + (1|Fish), grname = \"Fish\", data = data, datatype = \"Binary\", nboot = 0, npermut = 0)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n```{.r .cell-code}\n# Likelihood ratio test of random effect\nmForaging0 <- glmmTMB(Foraging.bin ~ Tank + Time + Filter + Order, data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nanova(mForaging0, mForaging)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: data\nModels:\nmForaging0: Foraging.bin ~ Tank + Time + Filter + Order, zi=~0, disp=~1\nmForaging: Foraging.bin ~ Tank + Time + Filter + Order + (1 | Fish), zi=~0, disp=~1\n           Df    AIC    BIC  logLik deviance Chisq Chi Df Pr(>Chisq)    \nmForaging0 12 300.08 342.43 -138.04   276.08                            \nmForaging  13 281.88 327.76 -127.94   255.88  20.2      1  6.976e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mForaging),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nConditional model:\n Groups Name        Variance\n Fish   (Intercept) 1.8     \n```\n:::\n:::\n\n\nCan calculate the repeatability but not its CI. I tried using bootstrap and permutation. Cannot calculate repeatability for Stereotypic swimming anyway. Hard to estimate repeatability on binary data. I don't know how to do it without the package rptR. I think we don't have enough data power anyway to calculate repeatability with a binary variable.\n\nLikelihood ratio test indicates a statistically significant random effect. Meaning that fish behaved differently among each others in terms of foraging. \n\n## Diagnosis \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmForaging_res <- simulateResiduals(mForaging)\nplot(mForaging_res)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in newton(lsp = lsp, X = G$X, y = G$y, Eb = G$Eb, UrS = G$UrS, L = G$L,\n: Fitting terminated with step failure - check results carefully\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-25-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplotResiduals(mForaging_res, form = data$Tank)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-25-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good.\n\n:::\n\n# Stereotypic swimming\n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Stereotypic.swimming)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-26-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntable(data$Stereotypic.swimming==0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n   80   172 \n```\n:::\n\n```{.r .cell-code}\ndescdist(data$Stereotypic.swimming, boot = 1000, print = FALSE)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-26-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nIdem Foraging. Analysis as binary variable if the fish performs stereotypic swimming during a trial or not. \n\nThere were 172 trials (out of 252) during which no stereotypic swimming happened.\n\n## Plot \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(plotSS1 <- plot_var_binary(data, \"SS.bin\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-27-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n(plotSS2 <- plot_var_binary_fish(data, \"SS.bin\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-27-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nHuge variability between fish as always. Some fish never performed stereotypic swimming while some in all tanks. \n\n## Generalised linear model \n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmSS <- glmmTMB(SS.bin ~ Tank + Time + Filter + Order + (1|Fish), data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mSS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: SS.bin\n         Chisq Df Pr(>Chisq)    \nTank   22.3290  4  0.0001723 ***\nTime    3.1486  3  0.3692807    \nFilter  1.7487  1  0.1860451    \nOrder   2.7610  3  0.4299628    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size_bin(mSS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1    jar_vs_small       0.03 0.02 Inf    1   -4.54  <0.001     0.003     0.220\n2   jar_vs_medium       0.23 0.22 Inf    1   -1.52   0.385     0.017     2.975\n3    jar_vs_large       0.23 0.23 Inf    1   -1.47   0.385     0.017     3.182\n4 small_vs_medium       8.43 7.49 Inf    1    2.40   0.082     0.808    87.883\n5  small_vs_large       8.63 7.93 Inf    1    2.35   0.082     0.764    97.398\n6 medium_vs_large       1.02 0.63 Inf    1    0.04   0.970     0.201     5.202\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich_bin(mSS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1 large_vs_barren       0.29 0.18 Inf    1   -1.96   0.051     0.081     1.003\n```\n:::\n:::\n\n\nEffect of Tank. \n\n+ Tank. Jar were less likely to perform stereotypic swimming during a trial than Small/Medium/Large but only significant between Jar and Small. Almost significant difference between Large and Barren: Fish in Barren were 3.4 times more likely to perform stereotypic swimming during a trial than fish in Large.\n\n## Between-fish diff\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Attempt to calculate repeatability\nrpt.SS <- rpt(SS.bin ~ Tank + Time + Filter + Order + (1|Fish), grname = \"Fish\", data = data, datatype = \"Binary\", nboot = 0, npermut = 0)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\nModel failed to converge with max|grad| = 0.00851543 (tol = 0.002, component 1)\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in checkConv(attr(opt, \"derivs\"), opt$par, ctrl = control$checkConv, :\nModel failed to converge with max|grad| = 0.00851543 (tol = 0.002, component 1)\n```\n:::\n\n```{.r .cell-code}\n# error\n\n# Likelihood ratio test of random effect\nmSS0 <- glmmTMB(SS.bin ~ Tank + Time + Filter, data = data, family =binomial)\nanova(mSS0, mSS)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: data\nModels:\nmSS0: SS.bin ~ Tank + Time + Filter, zi=~0, disp=~1\nmSS: SS.bin ~ Tank + Time + Filter + Order + (1 | Fish), zi=~0, disp=~1\n     Df    AIC    BIC   logLik deviance  Chisq Chi Df Pr(>Chisq)    \nmSS0  9 277.42 309.19 -129.710   259.42                             \nmSS  13 208.92 254.81  -91.462   182.92 76.496      4  9.614e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mSS),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nConditional model:\n Groups Name        Variance\n Fish   (Intercept) 8.5     \n```\n:::\n:::\n\n\nError when calculating the repeatability with rptR. \n\nLikelihood ratio test indicates a statistically significant random effect. Meaning that fish behaved differently among each others in terms of stereotypic swimming. \n\n## Diagnosis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmSS_res <- simulateResiduals(mSS)\nplot(mSS_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-30-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplotResiduals(mSS_res, form = data$Tank)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-30-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nIt is expected to have a problem with filter as there are more than twice more trials without filter than with filter. No problem when removing Filter from the model. The model seems good.\n\n## Stereotypic types\n\nJust a plot with the type of stereotypic swimming depending on the tank. To stick with the analysis, it is a count (count = 1 if the fish performs a certain type of stereotypic swimming during a trial). \n\nThe second plot groups similar stereotypic types together.\n\n\n::: {.cell .column-page layout-align=\"center\"}\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-31-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-31-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nIt seems that there are not differences between tanks. Just circles seem specific to larger tanks (Medium/Large/Barren).\n\n## Stereotypic Swimming repetitions\n\nFor example, repetition of pacing means how many times did the fish do one unit of pacing = one pace. \n\n\n::: {.cell .column-page layout-align=\"center\"}\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-32-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n     Tank          Fish     Time Stereotypic.swimming.type Nb.rep\n1   Small        Dragon  7:00 AM                    Pacing    328\n2   Small        Dragon 10:00 AM                    Pacing     76\n3   Small        Dragon  2:00 PM                    Pacing     20\n4   Small        Dragon  6:00 PM                    Pacing      8\n5   Small        Dragon  6:00 PM         Pacing front wall      8\n6  Barren        Dragon  7:00 AM                    Pacing      4\n7  Barren        Dragon 10:00 AM                    Pacing      5\n8  Barren        Dragon  2:00 PM                    Pacing     19\n9  Barren        Dragon  6:00 PM                    Pacing      4\n10    Jar           Elf  7:00 AM                   Zig zag      4\n11    Jar           Elf  6:00 PM                   Zig zag      6\n12  Small           Elf  7:00 AM                    Pacing     15\n13  Small           Elf 10:00 AM                    Pacing     15\n14  Small           Elf  2:00 PM                    Pacing    109\n15  Small           Elf  6:00 PM                    Pacing     25\n16 Medium           Elf  7:00 AM                    Pacing      4\n17 Medium           Elf 10:00 AM                    Pacing     34\n18 Medium           Elf  2:00 PM                    Pacing     14\n19  Large           Elf 10:00 AM                   Circles     12\n20  Large           Elf 10:00 AM                    Pacing      8\n21 Barren           Elf  7:00 AM                    Pacing    186\n22 Barren           Elf 10:00 AM                    Pacing      8\n23 Barren           Elf  6:00 PM                    Pacing      8\n24  Small         Fairy  7:00 AM                    Pacing    234\n25  Small         Fairy 10:00 AM                    Pacing    340\n26  Small         Fairy  2:00 PM                    Pacing    381\n27  Small         Fairy  6:00 PM                    Pacing    212\n28  Large         Fairy 10:00 AM                   Circles      8\n29  Large         Fairy 10:00 AM                    Pacing     22\n30  Large         Fairy  2:00 PM                    Pacing      7\n31 Barren         Fairy  7:00 AM                    Pacing      6\n32 Barren         Fairy 10:00 AM                    Pacing    396\n33 Barren         Fairy  2:00 PM                    Pacing    132\n34 Barren         Fairy  6:00 PM                    Pacing    111\n35  Small         Ghost  7:00 AM                    Pacing      3\n36  Small        Kraken  7:00 AM                    Pacing      6\n37  Small        Kraken  7:00 AM       Pacing with a hover    790\n38  Small        Kraken 10:00 AM       Pacing with a hover   1204\n39  Small        Kraken 10:00 AM                   Zig zag     77\n40  Small        Kraken  2:00 PM       Pacing with a hover    746\n41  Small        Kraken  2:00 PM                   Zig zag     64\n42 Medium        Kraken 10:00 AM                   Circles     13\n43 Medium        Kraken  2:00 PM                   Circles     22\n44  Large        Kraken  7:00 AM                   Circles      9\n45  Large        Kraken 10:00 AM                    Pacing     77\n46  Large        Kraken  2:00 PM                   Circles     43\n47  Large        Kraken  2:00 PM                    Pacing     41\n48  Large        Kraken  6:00 PM                   Circles      6\n49 Barren        Kraken  7:00 AM                   Circles     15\n50 Barren        Kraken  7:00 AM                   Zig zag     11\n51 Barren        Kraken 10:00 AM                   Circles     41\n52 Barren        Kraken 10:00 AM                    Pacing     28\n53 Barren        Kraken  2:00 PM                    Pacing     21\n54 Barren        Kraken  2:00 PM                   Zig zag     12\n55 Barren        Kraken  6:00 PM                   Circles      7\n56 Barren        Kraken  6:00 PM                    Pacing      0\n57  Small Orange Pendek 10:00 AM                    Pacing      5\n58 Medium Orange Pendek  7:00 AM                    Pacing      8\n59 Medium Orange Pendek 10:00 AM                    Pacing     41\n60 Medium Orange Pendek  2:00 PM                    Pacing      4\n61 Medium Orange Pendek  6:00 PM                    Pacing      3\n62  Large Orange Pendek  7:00 AM                   Circles     15\n63    Jar       Phoenix 10:00 AM                    Pacing      3\n64  Small       Phoenix  7:00 AM                    Pacing      7\n65  Small       Phoenix  2:00 PM                    Pacing     14\n66  Small       Phoenix  6:00 PM                    Pacing      8\n67 Medium       Phoenix  7:00 AM                    Pacing     36\n68 Medium       Phoenix 10:00 AM                    Pacing     19\n69 Medium       Phoenix  2:00 PM                    Pacing    100\n70 Medium       Phoenix  6:00 PM                    Pacing     58\n71  Large       Phoenix  7:00 AM                    Pacing      6\n72  Large       Phoenix 10:00 AM                    Pacing     19\n73  Large       Phoenix  2:00 PM                    Pacing     13\n74  Large       Phoenix  6:00 PM                    Pacing      8\n75 Barren       Phoenix 10:00 AM                   Circles     27\n76 Barren       Phoenix 10:00 AM                    Pacing     18\n77 Barren       Phoenix  2:00 PM           Pace then hover      0\n78 Barren       Phoenix  6:00 PM                   Circles      3\n79 Barren       Phoenix  6:00 PM           Pace then hover      0\n80    Jar        Wizard  2:00 PM                    Pacing      7\n81  Small        Wizard  7:00 AM                    Pacing    681\n82  Small        Wizard 10:00 AM                    Pacing      8\n83  Small        Wizard  6:00 PM                    Pacing     52\n84 Medium        Wizard  7:00 AM                    Pacing     35\n85 Medium        Wizard 10:00 AM                    Pacing     16\n86  Large        Wizard  7:00 AM                    Pacing     35\n87  Large        Wizard 10:00 AM                    Pacing    409\n88  Large        Wizard  2:00 PM                    Pacing    277\n89  Large        Wizard  6:00 PM                    Pacing    185\n90 Barren        Wizard  7:00 AM                    Pacing    527\n91 Barren        Wizard 10:00 AM                    Pacing    472\n92 Barren        Wizard  2:00 PM                    Pacing    432\n93 Barren        Wizard  6:00 PM                    Pacing    641\n```\n:::\n:::\n\n\nI don't think there are enough data to really say something about the number of repetitions. The number of repetitions seems pretty unique to a fish in a certain tank. I don't see an obvious pattern depending on the tank. The interesting thing is that the stereotypic swimming seemed consistent in a tank for a fish (most or all trials of that day with stereotypic swimming). It is a pitty we couldn't calculate the repeatability of the binomial glm of Stereotypic Swimming because it would have been interesting. \n\n:::\n\n# Interaction with walls\n\nInteraction with walls was formerly interaction with surface. We changed in the last stage because of the potential confusion with the water surface. \n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Interation.with.surface)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-33-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntable(data$Interation.with.surface==0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n  127   125 \n```\n:::\n:::\n\n\nIdem analysis binary generalised linear models.\n\n## Plot \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(plotInteracting1 <- plot_var_binary(data, \"Interacting.bin\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-34-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n(plotInteracting2 <- plot_var_binary_fish(data, \"Interacting.bin\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-34-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Generalised linear model \n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmInteracting <- glmmTMB(Interacting.bin ~ Tank + Time + Filter + Order + (1|Fish), data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mInteracting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Interacting.bin\n         Chisq Df Pr(>Chisq)   \nTank   17.1634  4   0.001797 **\nTime    5.0708  3   0.166684   \nFilter  0.0818  1   0.774878   \nOrder   1.9595  3   0.580856   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size_bin(mInteracting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1    jar_vs_small       1.78 0.81 Inf    1    1.26   0.412     0.534     5.954\n2   jar_vs_medium       0.76 0.41 Inf    1   -0.51   0.612     0.189     3.097\n3    jar_vs_large       4.83 2.58 Inf    1    2.95   0.016     1.179    19.760\n4 small_vs_medium       0.43 0.22 Inf    1   -1.63   0.310     0.109     1.690\n5  small_vs_large       2.71 1.41 Inf    1    1.91   0.224     0.685    10.706\n6 medium_vs_large       6.32 3.01 Inf    1    3.87  <0.001     1.796    22.204\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich_bin(mInteracting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1 large_vs_barren       0.29 0.13 Inf    1   -2.70   0.007     0.117     0.711\n```\n:::\n:::\n\n\nEffect of Tank.\n\n+ Tank. Fish were more likely to interact with the surface during a trial in Jar/Medium compared to Large (not significant for Small). In addition, fish were more likely to interact with a surface during a trial in Barren than in Large. \n\n## Between-fish diff\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmInteracting0 <- glmmTMB(Interacting.bin ~ Tank + Time + Filter + Order, data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nanova(mInteracting0, mInteracting)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: data\nModels:\nmInteracting0: Interacting.bin ~ Tank + Time + Filter + Order, zi=~0, disp=~1\nmInteracting: Interacting.bin ~ Tank + Time + Filter + Order + (1 | Fish), zi=~0, disp=~1\n              Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(>Chisq)    \nmInteracting0 12 350.58 392.93 -163.29   326.58                             \nmInteracting  13 333.41 379.30 -153.71   307.41 19.163      1    1.2e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mInteracting),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nConditional model:\n Groups Name        Variance\n Fish   (Intercept) 0.96    \n```\n:::\n:::\n\n\nLikelihood ratio test indicates a statistically significant random effect. Meaning that fish behaved differently among each others in terms of interaction with surface. \n\n## Diagnosis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmInteracting_res <- simulateResiduals(mInteracting)\nplot(mInteracting_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-37-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplotResiduals(mInteracting_res, form = data$Tank)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-37-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good.\n\n## Interacting types\n\nJust a plot with the type of interaction depending on the tank. To stick with the analysis, it is a count (count = 1 if the fish performs a certain type of interaction with surface during a trial). \n\nThe second plot groups similar interactions with surface together.\n\n\n::: {.cell .column-page layout-align=\"center\"}\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-38-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-38-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n:::\n\n# Nest.building\n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Nest.building)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-39-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntable(data$Nest.building==0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n   51   201 \n```\n:::\n:::\n\n\nThere are 1 trial out of 5 where there was nest building. Analysis with binary generalised model.\n\n## Plot \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(plotNest1 <- plot_var_binary(data, \"Nest.bin\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-40-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n(plotNest2<- plot_var_binary_fish(data, \"Nest.bin\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-40-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\n## Generalised linear model \n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmNest <- glmmTMB(Nest.bin ~ Tank + Time + Filter + Order + (1|Fish), data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mNest)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Nest.bin\n         Chisq Df Pr(>Chisq)    \nTank    8.6944  4  0.0692076 .  \nTime    7.3587  3  0.0613014 .  \nFilter 11.7652  1  0.0006035 ***\nOrder   4.6506  3  0.1992406    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size_bin(mNest)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1    jar_vs_small       0.25 0.14 Inf    1   -2.40   0.097     0.052     1.147\n2   jar_vs_medium       0.20 0.14 Inf    1   -2.31   0.104     0.033     1.254\n3    jar_vs_large       0.23 0.15 Inf    1   -2.23   0.104     0.039     1.310\n4 small_vs_medium       0.83 0.49 Inf    1   -0.32  >0.999     0.174     3.943\n5  small_vs_large       0.92 0.54 Inf    1   -0.14  >0.999     0.198     4.313\n6 medium_vs_large       1.11 0.64 Inf    1    0.19  >0.999     0.244     5.101\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich_bin(mNest)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast odds.ratio   SE  df null z.ratio p.value asymp.LCL asymp.UCL\n1 large_vs_barren       3.60 2.57 Inf    1    1.79   0.073     0.889    14.576\n```\n:::\n\n```{.r .cell-code}\nemmeans(mNest, ~ Filter, type = \"response\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Filter      prob     SE  df asymp.LCL asymp.UCL\n No-filter 0.2125 0.0665 Inf   0.11018    0.3702\n Filter    0.0166 0.0133 Inf   0.00338    0.0771\n\nResults are averaged over the levels of: Tank, Time, Order \nConfidence level used: 0.95 \nIntervals are back-transformed from the logit scale \n```\n:::\n:::\n\n\nEffect of Filter only.\n\n+ Tank. Almost significant.\n+ Filter. Fish were more likely to build a nest without a filter in their tank.\n\n## Between-fish diff\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmNest0 <- glmmTMB(Nest.bin ~ Tank + Time + Filter + Order, data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nanova(mNest0, mNest)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: data\nModels:\nmNest0: Nest.bin ~ Tank + Time + Filter + Order, zi=~0, disp=~1\nmNest: Nest.bin ~ Tank + Time + Filter + Order + (1 | Fish), zi=~0, disp=~1\n       Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(>Chisq)    \nmNest0 12 240.49 282.84 -108.24   216.49                             \nmNest  13 229.78 275.67 -101.89   203.78 12.703      1  0.0003652 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mNest),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nConditional model:\n Groups Name        Variance\n Fish   (Intercept) 1.1     \n```\n:::\n:::\n\n\nLikelihood ratio test indicates a statistically significant random effect. Meaning that fish behaved differently among each others in terms of nest building. \n\n## Diagnosis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmNest_res <- simulateResiduals(mNest)\nplot(mNest_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-43-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplotResiduals(mNest_res, form = data$Tank)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-43-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplotResiduals(mNest_res, form = data$Filter)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-43-3.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good.\n\n:::\n\n# Hovering\n\nWe analysed hovering in two models:\n\n+ a glm with the occurence of hovering during a trial as the response variable (binary variable) like for Foraging, Steterotypic Swimming, etc\n+ a lm with the amount of time hovering during a trial (continuous variable). We had 204 trials with hovering time > 0. \n\nFor the lm, we tried different models described in \"Analysis_Hovering\". The best model was a linear mixed model on the amount of time spent hovering with weighted least squares (WLS). We had to use WLS because the error variance was increasing with the fitted values-higher error variance associated with high hovering time values. It was not possible to use WLS with the lmer package so we had to use the nlme package. The nlme package does not handle confounding levels of two factors - the fact that Tank = Barren is the same as Order = 5. So we had to remove Order from the analysis. The addition/removal of Order was not changing the analysis outcomes in the other models. \n\n::: {.panel-tabset}\n\n## Distribution \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhist1(data$Hovering)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-44-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntable(data$Hovering==0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n  204    48 \n```\n:::\n\n```{.r .cell-code}\ndescdist(data$Hovering, boot = 1000, print = FALSE)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-44-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nquantile(data$Hovering)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    0%    25%    50%    75%   100% \n  0.00   6.01  23.71  56.21 344.27 \n```\n:::\n\n```{.r .cell-code}\n# histogram without the zeros\nhist1(data$Hovering[data$Hovering!=0]) \n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-44-3.png){fig-align='center' width=100%}\n:::\n:::\n\n\nEven if there are less zeros than Foraging or Stereotypic Swimming, it is not a normal distribution. There were only 48 trials (out of 252) during which no hovering happened. So 204 trials where we could study the amount of time hovering in 204 trials. \n\n## Plot \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Effect of tank of the probability to hover during a trial\nplot_var_binary(data, \"Hovering.bin\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-45-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot_var_binary_fish(data, \"Hovering.bin\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-45-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n# Among the trials where the fish hovers, effect of tank on the amount of time hovering\ndata %>% filter(Hovering >0) %>% \n  plot_var(., \"Hovering\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-45-3.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ndata %>% filter(Hovering >0) %>% \n  plot_var_fish(., \"Hovering\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-45-4.png){fig-align='center' width=100%}\n:::\n:::\n\n\nBoth the probability to hover and the time spent hovering seems to be higher in Jar compared to the others. All fish besides Goblin hovered more in Jar compared to Small.\n\n## Generalised linear model \n\nY variable = probability to hover during a trial\n\n\n::: {.cell .column-page layout-align=\"center\"}\n\n```{.r .cell-code}\nmHovering <- glmmTMB(Hovering.bin ~ Tank + Time + Filter + Order + (1|Fish), data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nglmmTMB:::Anova.glmmTMB(mHovering)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table (Type II Wald chisquare tests)\n\nResponse: Hovering.bin\n        Chisq Df Pr(>Chisq)  \nTank   6.6046  4    0.15832  \nTime   9.4413  3    0.02396 *\nFilter 4.9879  1    0.02553 *\nOrder  1.9380  3    0.58538  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nemmeans(mHovering, ~ Time, type = \"response\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Time      prob     SE  df asymp.LCL asymp.UCL\n 7:00 AM  0.918 0.0400 Inf     0.798     0.969\n 10:00 AM 0.870 0.0531 Inf     0.727     0.944\n 2:00 PM  0.727 0.0803 Inf     0.546     0.855\n 6:00 PM  0.746 0.0776 Inf     0.568     0.867\n\nResults are averaged over the levels of: Tank, Filter, Order \nConfidence level used: 0.95 \nIntervals are back-transformed from the logit scale \n```\n:::\n\n```{.r .cell-code}\nemmeans(mHovering, ~ Filter, type = \"response\") \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Filter     prob     SE  df asymp.LCL asymp.UCL\n No-filter 0.907 0.0338 Inf     0.816     0.955\n Filter    0.712 0.1001 Inf     0.487     0.866\n\nResults are averaged over the levels of: Tank, Time, Order \nConfidence level used: 0.95 \nIntervals are back-transformed from the logit scale \n```\n:::\n\n```{.r .cell-code}\n## Random effect\nmHovering0 <- glmmTMB(Hovering.bin ~ Tank + Time + Filter + Order, data = data, family =binomial)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ndropping columns from rank-deficient conditional model: Order5\n```\n:::\n\n```{.r .cell-code}\nanova(mHovering0, mHovering)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nData: data\nModels:\nmHovering0: Hovering.bin ~ Tank + Time + Filter + Order, zi=~0, disp=~1\nmHovering: Hovering.bin ~ Tank + Time + Filter + Order + (1 | Fish), zi=~0, disp=~1\n           Df   AIC    BIC  logLik deviance  Chisq Chi Df Pr(>Chisq)  \nmHovering0 12 245.5 287.86 -110.75    221.5                           \nmHovering  13 241.7 287.59 -107.85    215.7 5.7995      1    0.01603 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nprint(VarCorr(mHovering),comp=c(\"Variance\"), digits=2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nConditional model:\n Groups Name        Variance\n Fish   (Intercept) 0.63    \n```\n:::\n:::\n\n\nNo effect of Tank on the probability to hover during a trial, only an effect of Time and Filter\n\n+ Time. It seems that fish were more likely to hover in the morning.\n+ Filter. It seems that fish were less likely to hover with a filter in their tank.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmHovering_res <- simulateResiduals(mHovering)\nplot(mHovering_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-47-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good. \n\n## Linear model\n\nY variable = amount of time spent hovering during a trial. Only trials with hovering time > 0\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmHovering2 <- lme(Hovering ~ Tank + Time + Filter, random = ~1 | Fish, data = data[data$Hovering>0, ], weights = varPower(), control = lmeControl(maxIter = 20000))\nanova(mHovering2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n            numDF denDF  F-value p-value\n(Intercept)     1   183 43.85489  <.0001\nTank            4   183 18.75147  <.0001\nTime            3   183  3.66785  0.0134\nFilter          1   183  5.29132  0.0226\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size(mHovering2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1    jar_vs_small       53 12.0 183    4.40  <0.001       21       85\n2   jar_vs_medium       53 12.0 183    4.42  <0.001       21       85\n3    jar_vs_large       61 11.9 183    5.10  <0.001       29       93\n4 small_vs_medium        1  6.5 183    0.08   0.938      -17       18\n5  small_vs_large        8  6.2 183    1.30   0.394       -9       25\n6 medium_vs_large        8  2.7 183    2.81   0.016        0       15\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich(mHovering2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate  SE  df t.ratio p.value lower.CL upper.CL\n1 large_vs_barren      -22 4.9 183   -4.53  <0.001      -32      -12\n```\n:::\n\n```{.r .cell-code}\nemmeans(mHovering2, ~ Time)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Time     emmean   SE df lower.CL upper.CL\n 7:00 AM    39.3 5.06 12     28.2     50.3\n 10:00 AM   48.3 5.72 12     35.8     60.8\n 2:00 PM    48.1 5.68 12     35.7     60.4\n 6:00 PM    42.4 5.23 12     31.0     53.8\n\nResults are averaged over the levels of: Tank, Filter \nDegrees-of-freedom method: containment \nConfidence level used: 0.95 \n```\n:::\n\n```{.r .cell-code}\nemmeans(mHovering2, ~ Filter)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Filter    emmean   SE df lower.CL upper.CL\n No-filter   52.2 5.30 12     40.7     63.8\n Filter      36.8 6.53 12     22.5     51.0\n\nResults are averaged over the levels of: Tank, Time \nDegrees-of-freedom method: containment \nConfidence level used: 0.95 \n```\n:::\n\n```{.r .cell-code}\n# no random effect estimate possible with the weighted least squares\n```\n:::\n\n\nEffect of Tank, Time and Filter.\n\n+ Tank. Jar hovered significantly more time than Small, Medium and Large. Fish in Jar hovered 53 sec [CI 20, 85] more than Small (over a 600 sec trial), 53 sec [CI 20, 86] more than Medium, and 61 sec [CI 28, 93] more than Large. Fish in medium hovered more time than fish in Large. In addition, fish in Barren hovered significantly more time (22 sec [CI 12, 35]) than fish in Large.\n+ Time. It seems that fish hovered more time in the middle of the day.\n+ Filter. It seems that fish hovered less time with a filter in their tank.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(mHovering2, resid(., type = \"pearson\") ~ fitted(.), aspect = 1, pch = 21, abline = 0)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-49-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot(mHovering2, abs(resid(., type = \"pearson\")) ~ fitted(.), aspect = 1, pch = 21, abline = 0)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-49-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nqqnorm(resid(mHovering2, type = \"pearson\"))\nqqline(resid(mHovering2, type = \"pearson\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-49-3.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nranefPlot <- ranef(mHovering2, level = 1)\nqqnorm(ranefPlot$`(Intercept)`)\nqqline(ranefPlot$`(Intercept)`)\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-49-4.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good besides the normality. But linear models are robust to the normality assumption (= we can still draw true inference).\n\n## Hovering place\n\nJust a plot with where the fish hovers depending on the tank.\n\n\n::: {.cell .column-page layout-align=\"center\"}\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-50-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-50-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nFish used different places for hovering.\n\n:::\n\n\n# Up and down \n\nWe scored whether the fish was on the upper half or lower half of the tank for all behaviours. Research question: did fish use differently use the upper part or lower part of their tank depending of the tank type?\n\n::: {.panel-tabset}\n\n## Plot\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(dataUpDown, aes(y = adj.up, x = Tank)) +\n    geom_jitter(alpha = .5, width = 0.05, height=0, color = grey(0.25)) +\n    stat_summary(fun.y = mean,geom = \"point\",colour = \"red\", size = 4)+\n    stat_summary(fun.min = function(x) mean(x) - sd(x), \n                 fun.max = function(x) mean(x) + sd(x), \n                 geom = \"errorbar\",colour = \"red\", width = 0.15)+\n  ylab(\"Time up (sec)\")\n```\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-51-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nIt seems that the tank has an influence on whether fish prefer being on the upper half or lower half of the tank.\n\n## Model\n\nWe can do different models:\n+ Look at the percentage of time spent up of the trial. Fit a beta distribution. Problem: All percentages need to be 0 < perc < 100%. There are trials with 100% so we can't use beta distribution. \n\n+ Look at the count of seconds (how many seconds the fish spend up of the tank). Fit a binomial distribution. Problem: The diagnostics plots were very bad when fitting mUp <- glmmTMB(cbind(up, down) ~ Tank + Time + Filter + (1|Fish), data = dataUpDown, family = binomial)\n\n+ Look simply at the actual time spent up. Fit a normal distribution. The response variable can be adjusted by the fact that the trial were not perfectly 600 sec. $adj.up= \\frac{\\text{time spent up} * 600}{\\text{trial total duration}}$. It is what has been done.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmUp <- lmer(adj.up ~ Tank + Time + Filter + Order + (1|Fish), data = dataUpDown)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nfixed-effect model matrix is rank deficient so dropping 1 column / coefficient\n```\n:::\n\n```{.r .cell-code}\nanova(mUp, ddf = \"Kenward-Roger\", type = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nType II Analysis of Variance Table with Kenward-Roger's method\n       Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank   251386   62846     4 234.07  3.8215 0.0049776 ** \nTime   284189   94730     3 228.06  5.7613 0.0008159 ***\nFilter  87414   87414     1 130.01  5.3164 0.0227095 *  \nOrder   70637   23546     3 230.78  1.4320 0.2341679    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.size(mUp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1    jar_vs_small      -71 26.0 229   -2.72   0.036     -140       -1\n2   jar_vs_medium       33 29.9 240    1.10   0.667      -47      112\n3    jar_vs_large        2 29.4 240    0.06   0.953      -76       80\n4 small_vs_medium      103 29.1 240    3.55   0.003       26      181\n5  small_vs_large       72 28.9 240    2.50   0.052       -5      149\n6 medium_vs_large      -31 25.4 228   -1.22   0.667      -99       36\n```\n:::\n\n```{.r .cell-code}\ncontr_tank.enrich(mUp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         contrast estimate   SE  df t.ratio p.value lower.CL upper.CL\n1 large_vs_barren      -25 25.9 229   -0.97   0.335      -76       26\n```\n:::\n\n```{.r .cell-code}\nemmeans(mUp, ~ Time) # estimated means of time spent swimming depending on the time of the day \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Time     emmean   SE   df lower.CL upper.CL\n 7:00 AM     274 24.1 30.6      225      323\n 10:00 AM    279 24.1 30.6      230      329\n 2:00 PM     224 24.1 30.6      175      273\n 6:00 PM     200 24.1 30.6      151      249\n\nResults are averaged over the levels of: Tank, Filter, Order \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n:::\n\n```{.r .cell-code}\nemmeans(mUp, ~ Filter) # estimated means of time spent swimming depending on the time of the day\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Filter    emmean   SE   df lower.CL upper.CL\n No-filter    280 20.6 15.4      237      324\n Filter       208 28.9 35.1      150      267\n\nResults are averaged over the levels of: Tank, Time, Order \nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n:::\n:::\n\n\nEffect of Tank, Time and Filter. \n\n+ Tank. Statistically significant difference between Small and Medium/Jar: Fish in Small tank spent on average 103 more seconds [95% CI 26, 181] on the upper half of the tank compared to fish in Medium tanks. At the opposite, Fish in Small tank spent on average 71 more seconds [95% CI 26, 181] on the lower half of the tank compared to fish in Jar tanks. \n+ Time. Fish spent more time on the upper half of the tank in the morning.\n+ Filter. Fish spent more time on the upper half of the tank with a filter in their tank.\n\n## Diagnosis\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlm_diagnosis(mUp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"check constant variance over fitted values\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-53-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-53-2.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality of adj.up\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-53-3.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality random residuals\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-53-4.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_files/figure-html/unnamed-chunk-53-5.png){fig-align='center' width=100%}\n:::\n:::\n\n\nThe model seems good.\n\n:::\n\n# R version \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.3 (2024-02-29 ucrt)\nPlatform: x86_64-w64-mingw32/x64 (64-bit)\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: Pacific/Guadalcanal\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] renv_1.0.7          mclogit_0.9.6       nlme_3.1-164       \n [4] performance_0.12.2  rptR_0.9.22         DHARMa_0.4.6       \n [7] glmmTMB_1.1.9       fitdistrplus_1.1-11 survival_3.5-8     \n[10] MASS_7.3-60.0.1     emmeans_1.10.1      lmerTest_3.1-3     \n[13] lme4_1.1-35.2       Matrix_1.6-5        FactoMineR_2.10    \n[16] RColorBrewer_1.1-3  ggforce_0.4.2       ggrepel_0.9.5      \n[19] ggpubr_0.6.0        lubridate_1.9.3     forcats_1.0.0      \n[22] stringr_1.5.1       dplyr_1.1.3         purrr_1.0.2        \n[25] readr_2.1.5         tidyr_1.3.1         tibble_3.2.1       \n[28] ggplot2_3.5.0       tidyverse_2.0.0    \n\nloaded via a namespace (and not attached):\n [1] Rdpack_2.6           rlang_1.1.1          magrittr_2.0.3      \n [4] compiler_4.3.3       mgcv_1.9-1           vctrs_0.6.3         \n [7] pkgconfig_2.0.3      fastmap_1.1.1        backports_1.4.1     \n[10] labeling_0.4.3       utf8_1.2.3           promises_1.3.0      \n[13] rmarkdown_2.26       tzdb_0.4.0           nloptr_2.0.3        \n[16] xfun_0.43            jsonlite_1.8.8       flashClust_1.01-2   \n[19] later_1.3.2          tweenr_2.0.3         broom_1.0.5         \n[22] parallel_4.3.3       cluster_2.1.6        gap.datasets_0.0.6  \n[25] R6_2.5.1             qgam_1.3.4           stringi_1.8.3       \n[28] car_3.1-2            boot_1.3-29          numDeriv_2016.8-1.1 \n[31] estimability_1.5     iterators_1.0.14     Rcpp_1.0.11         \n[34] knitr_1.46           httpuv_1.6.15        splines_4.3.3       \n[37] timechange_0.3.0     tidyselect_1.2.1     rstudioapi_0.16.0   \n[40] abind_1.4-5          yaml_2.3.8           codetools_0.2-19    \n[43] doParallel_1.0.17    memisc_0.99.31.7     TMB_1.9.11          \n[46] plyr_1.8.9           lattice_0.22-5       shiny_1.8.1.1       \n[49] withr_3.0.0          evaluate_0.23        polyclip_1.10-6     \n[52] pillar_1.9.0         gap_1.5-3            carData_3.0-5       \n[55] foreach_1.5.2        DT_0.33              insight_0.20.2      \n[58] generics_0.1.3       hms_1.1.3            munsell_0.5.1       \n[61] scales_1.3.0         minqa_1.2.6          xtable_1.8-4        \n[64] leaps_3.1            glue_1.6.2           scatterplot3d_0.3-44\n[67] tools_4.3.3          see_0.8.5            data.table_1.15.4   \n[70] ggsignif_0.6.4       mvtnorm_1.2-3        grid_4.3.3          \n[73] rbibutils_2.2.16     colorspace_2.1-0     patchwork_1.2.0     \n[76] cli_3.6.1            fansi_1.0.4          gtable_0.3.4        \n[79] rstatix_0.7.2        digest_0.6.35        pbkrtest_0.5.2      \n[82] htmlwidgets_1.6.4    farver_2.1.1         htmltools_0.5.8.1   \n[85] lifecycle_1.0.4      multcompView_0.1-10  mime_0.12           \n```\n:::\n:::\n\n\n:::\n",
    "supporting": [
      "Analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}