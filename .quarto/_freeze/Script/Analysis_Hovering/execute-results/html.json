{
  "hash": "1ff0ec717bcc960d64cf92b1a5a14582",
  "result": {
    "markdown": "---\ntitle: \"Analysis Hovering\"\ndate: \"2024-03-29\"\nauthor: \"Juliette Tariel-Adam\"\nformat: \n   html:\n    embed-resources: true\n    self-contained-math: true\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk:\n    fig-align: center\n    out-width: \"100%\"\n---\n\n\n\n\n::: {.panel-tabset}\n\n# Poisson distribution\n\nY variable = amount of time spent hovering during a trial, rounded to be an integer in seconds\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# poisson on all hovering data\nmHovering <- glmmTMB(round(Hovering,0) ~ Tank + Time + Filter + (1|Fish), data = data, family =poisson)\nmHovering_res <- simulateResiduals(mHovering)\nplot(mHovering_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n# zero inflated poisson on all hovering data\nmHovering <- glmmTMB(round(Hovering,0) ~ Tank + Time + Filter + (1|Fish), data = data, family =poisson,ziformula=~1)\nmHovering_res <- simulateResiduals(mHovering)\nplot(mHovering_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-2-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n# poisson on positive hovering data\nmHovering <- glmmTMB(round(Hovering,0) ~ Tank + Time + Filter + (1|Fish), data = data[data$Hovering >0,], family =poisson)\nmHovering_res <- simulateResiduals(mHovering)\nplot(mHovering_res)\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-2-3.png){fig-align='center' width=100%}\n:::\n:::\n\n\nFit are not good\n\n# Attempt transformation log(Y + 1)\n\nY variable = amount of time spent hovering during a trial. \n\nOnly considering positive hovering data Y > 0 \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 1)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 5)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 10)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-3.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 15)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-4.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 20)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-5.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 25)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-6.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 30)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-7.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 50)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-8.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log(Hovering + 70)))+\n  geom_histogram(bins = 15, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-9.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nggplot(data, aes(x = log10(Hovering + 103)))+\n  geom_histogram(bins = 10, fill = grey(0.75), color=\"black\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-10.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nmHovering <- lmer(log(Hovering+103)~Tank + Time + Filter + (1|Fish), data = data)\ncheck_model(mHovering, check = \"normality\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-11.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ncheck_model(mHovering, check = \"homogeneity\")\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-3-12.png){fig-align='center' width=100%}\n:::\n:::\n\n\nWe had to go log(y + 103) which is not a problem per se, because the value to add depends on the scale of the variable. Hovering varies between 0 and 600. \n\nBut anyway the fit is not good with increase of variance in residuals with fitted values.\n\n# Linear model\n\nY variable = amount of time spent hovering during a trial. \n\nOnly considering positive hovering data Y > 0 \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmHovering <- lmer(Hovering ~ Tank + Time + Filter + (1|Fish), data = data[data$Hovering>0,])\nlm_diagnosis(mHovering)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"check linearity and constant variance over fitted values\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"check further constant variance over fitted values\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-4-2.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Normality of Hovering\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-4-3.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"normality random residuals\"\n```\n:::\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-4-4.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-4-5.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nlm_results(mHovering)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Anova\"\nType II Analysis of Variance Table with Kenward-Roger's method\n       Sum Sq Mean Sq NumDF  DenDF F value    Pr(>F)    \nTank    96186 24046.6     4 189.07 12.7643 3.234e-09 ***\nTime     9746  3248.8     3 183.54  1.7247   0.16347    \nFilter   5739  5738.8     1 148.50  3.0466   0.08297 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n[1] \"Fixed effect estimates\"\n               Estimate Std. Error        df    t value     Pr(>|t|)\n(Intercept)   92.506905  10.835605  42.94304  8.5373085 8.422634e-11\nTankSmall    -53.479352   9.629722 184.97384 -5.5535716 9.619285e-08\nTankMedium   -57.824023  10.863526 194.16919 -5.3227674 2.805786e-07\nTankLarge    -59.480394  10.609878 194.25818 -5.6061334 7.027516e-08\nTankBarren   -29.484045  11.031338 194.24627 -2.6727533 8.162787e-03\nTime10:00 AM  13.709502   8.273500 183.22574  1.6570378 9.922315e-02\nTime2:00 PM    8.194674   8.651030 183.30985  0.9472484 3.447593e-01\nTime6:00 PM   -4.127883   8.596296 183.41944 -0.4801932 6.316622e-01\nFilterFilter -20.504136  11.425362 147.75464 -1.7946159 7.475933e-02\n```\n:::\n:::\n\n\nProblem homogeneity of variance, increase of residual variance with fitted values\n\n# Linear model with power \n\nIn Weighted Least Squares (WLS, each observation is given a weight inversely proportional to its variance, helping to stabilize the variance across the fitted values.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmHovering <- lme(Hovering ~ Tank + Time + Filter, random = ~1 | Fish, data = data[data$Hovering>0,], weights = varPower(), control = lmeControl(maxIter = 20000))\nplot(mHovering, resid(., type = \"pearson\") ~ fitted(.), aspect = 1, pch = 21, abline = 0)\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nqqnorm(resid(mHovering, type = \"pearson\"))\nqqline(resid(mHovering, type = \"pearson\"))\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-5-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nranefPlot <- ranef(mHovering, level = 1)\nqqnorm(ranefPlot$`(Intercept)`)\nqqline(ranefPlot$`(Intercept)`)\n```\n\n::: {.cell-output-display}\n![](Analysis_Hovering_files/figure-html/unnamed-chunk-5-3.png){fig-align='center' width=100%}\n:::\n:::\n\n\n::: \n\n",
    "supporting": [
      "Analysis_Hovering_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}