{
  "hash": "c5d48804c65c6c51cb25499173661c0e",
  "result": {
    "markdown": "---\ntitle: \"PCA Analysis of Naomi's data. Influence of the tank on Betta's behaviour.\"\ndate: \"2024-07-25\"\nauthor: \"Juliette Tariel-Adam\"\nformat: \n   html:\n    embed-resources: true\n    self-contained-math: true\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk:\n    fig-align: center\n    out-width: \"100%\"\n---\n\n\n\n\nWe tried a PCA on:\n\n+ scaled variables.\n  * All variables are divided by their standard deviation and have therefore the same variance / standard deviation of 1. It is the standard PCA.\n  * But the problem with PCA on scaled variables it that it cannot quantitatively interpret the differences between treatments (for instance we can't say 100 sec resting more in Large than Barren). It stays a qualitative analysis (for instance more time spent resting in Large than Barren). A solution is to then give some numbers by calculating them on raw behavioural types. \n+ non-scaled variables. All behavioural variables have the same unit, which means we can do a PCA without scaling the variables. The variables with the higher variance will contribute more to the PCA. \n  * PCA using non-scaled variables can quantitatively interpret the differences.\n  * But it gives more importance to behavioural variables that have the more variance. And I don't see why we should give more importance to certain variables or not. A difference of 10 sec in stereotypic swimming might be as relevant as a difference of 50 s swimming.\n\nSo we decide to do PCA using scaled variables because of this last point: we don't want to give more importance to behaviours with the most variance. (And also the circle of correlations looks worst with non-scaled variables = less easy to interpret. As our behaviour variables were very different in variance, the length of the arrows in the circle of correlations are very different).\n\nAlso, I was concerned of running PCA on repeated measures, but apparently it is not a big deal.\n\n::: {.panel-tabset}\n\n# Scaled variables\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npcaS <- PCA(data[,beh.cols], graph = FALSE, scale.unit = TRUE)\npcaS$eig\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       eigenvalue percentage of variance cumulative percentage of variance\ncomp 1 1.99367384             28.4810549                          28.48105\ncomp 2 1.27919452             18.2742074                          46.75526\ncomp 3 1.21631822             17.3759745                          64.13124\ncomp 4 1.10583365             15.7976236                          79.92886\ncomp 5 0.84562429             12.0803469                          92.00921\ncomp 6 0.55086261              7.8694659                          99.87867\ncomp 7 0.00849287              0.1213267                         100.00000\n```\n:::\n\n```{.r .cell-code}\nfviz_eig(pcaS, addlabels = TRUE)\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\nRules to keep an component:\n\n+ eigen value > 1\n+ Cumulative percentage of variance > 95% \n+ component before the drop\n\nDepending on the rules, we should keep between 4 (eigen value > 1) or 7 components (cumulative percentage of variance > 95%). Keeping 7 components is pointless! We keep only 4 components, explaining 70$ of total variance. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npcaS <- PCA(data[,beh.cols], ncp=4,graph = FALSE, scale.unit = TRUE)\nplot(pcaS, choix = \"var\", axes = c(1,2)) \n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot(pcaS, choix = \"var\", axes = c(3,4))\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-3-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n# how well each variable correlates with and contributes to the variation explained by each principal component\nround(pcaS$var$cos2,1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                        Dim.1 Dim.2 Dim.3 Dim.4\nSwimming                  0.7   0.0   0.1   0.0\nResting                   0.8   0.0   0.2   0.0\nHovering                  0.0   0.5   0.1   0.1\nStereotypic.swimming      0.1   0.5   0.2   0.2\nNest.building             0.0   0.0   0.5   0.3\nForaging                  0.3   0.0   0.2   0.2\nInteration.with.surface   0.1   0.2   0.0   0.3\n```\n:::\n\n```{.r .cell-code}\n# extent to which each variable contributes to the total variance explained by the first 4 components\nrowSums(pcaS$var$contrib)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Swimming                 Resting                Hovering \n               42.86546                55.71955                51.74578 \n   Stereotypic.swimming           Nest.building                Foraging \n               76.42204                75.39455                51.11117 \nInteration.with.surface \n               46.74144 \n```\n:::\n\n```{.r .cell-code}\n# extent to which each variable contributes to the total variance explained by the first 3 components\nrowSums(pcaS$var$contrib[,1:3])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Swimming                 Resting                Hovering \n               42.44136                55.07072                46.15749 \n   Stereotypic.swimming           Nest.building                Foraging \n               57.83766                44.57373                33.30029 \nInteration.with.surface \n               20.61874 \n```\n:::\n:::\n\n\n+ 1st axis: Swimming, Foraging vs Resting\n+ 2nd axis: Hovering vs Stereotypic swimming\n+ 3rd axis: Mostly Nest.building vs Foraging\n+ 4th axis: almost all variables, difficult to interpret\n\nAs the 4th axis is difficult to interpret, we could keep 3 easy-interpretable components to explain 57% of the variance. 57% of the variance is not a lot... We thus decided to study behaviours individually. The advantage of studying behaviours individually is also to be able to interpret quantitatively the differences between treatments (like said before, 100 sec difference between tank X and tank Y).\n\nSinking.Floating (and to a lesser extent Interaction.with.surface) is not very useful for the first 4 components, so not useful to explain the variability between trials (and this even though they are scaled = contribute to the PCA to the same extent that variables with higher initial variance).\n\nBelow plot of the first two components with tank or fish ellipses overlaid.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfviz_pca_biplot(pcaS, geom.ind = \"point\", col.ind = data$Tank, col.var=\"black\",\n\t\t\t\t\t\t\taddEllipses = TRUE, legend.title = \"Tank\", palette = viridis(5))\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nfviz_pca_biplot(pcaS, geom.ind = \"point\", col.ind = data$Fish, col.var=\"black\",\n\t\t\t\t\t\t\taddEllipses = TRUE, legend.title = \"Fish\", palette = viridis(13))\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-4-2.png){fig-align='center' width=100%}\n:::\n:::\n\n\nNo clear distinction between the different tanks or fish. Common in behaviour ecology to not have clear groups.\n\n# Non-scaled variables\n\nResting and Swimming have the highest variance (see below) and they will therefore contribute more to the PCA using non-scaled variables. Sinking.Floating, Foraging and Hovering have the lowest variances.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\napply(data[,beh.cols], 2, var) # variance of each variable\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Swimming                 Resting                Hovering \n             11870.9451              26738.2171               2938.9565 \n   Stereotypic.swimming           Nest.building                Foraging \n             10796.2814               7041.0466                314.5212 \nInteration.with.surface \n              1114.0036 \n```\n:::\n\n```{.r .cell-code}\npcaNS <- PCA(data[,beh.cols], graph = FALSE, scale.unit = FALSE)\npcaNS$eig\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        eigenvalue percentage of variance cumulative percentage of variance\ncomp 1 34667.58726             57.2330736                          57.23307\ncomp 2 11815.22484             19.5058753                          76.73895\ncomp 3  8976.18729             14.8188792                          91.55783\ncomp 4  3535.83400              5.8373444                          97.39517\ncomp 5  1195.24795              1.9732470                          99.36842\ncomp 6   315.72079              0.5212267                          99.88965\ncomp 7    66.84416              0.1103537                         100.00000\n```\n:::\n\n```{.r .cell-code}\nfviz_eig(pcaNS, addlabels = TRUE)\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\n# if we keep 4 variables\npcaNS <- PCA(data[,beh.cols], ncp=4,graph = FALSE, scale.unit = FALSE)\nplot(pcaNS, choix = \"var\", axes = c(1,2))\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-5-2.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nplot(pcaNS, choix = \"var\", axes = c(3,4))\n```\n\n::: {.cell-output-display}\n![](Analysis_PCA_files/figure-html/unnamed-chunk-5-3.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\nround(pcaNS$var$cos2,1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                        Dim.1 Dim.2 Dim.3 Dim.4\nSwimming                  0.5   0.3   0.1   0.0\nResting                   1.0   0.0   0.0   0.0\nHovering                  0.0   0.0   0.0   0.9\nStereotypic.swimming      0.2   0.7   0.1   0.0\nNest.building             0.1   0.0   0.9   0.1\nForaging                  0.1   0.1   0.0   0.0\nInteration.with.surface   0.0   0.0   0.0   0.1\n```\n:::\n\n```{.r .cell-code}\nrowSums(pcaNS$var$contrib)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               Swimming                 Resting                Hovering \n              76.498853               82.342630               73.856223 \n   Stereotypic.swimming           Nest.building                Foraging \n              82.201162               82.268528                0.572337 \nInteration.with.surface \n               2.260267 \n```\n:::\n:::\n\n\nUsing the cumulative percentage of variance's  rule, 4 variables will be enough. 3 axis might be good enough as the 4th axis is bringing only 6% of variance.\n\n+ 1st axis: Resting vs Swimming, Stereotypic.swimming\n+ 2nd axis: Swimming vs Stereotypic swimming \n+ 3rd axis: Mostly Nest.building \n+ 4th axis: Mostly Hovering\n\nAgain Sinking.Floating is not explaining a lot of variance. Hovering is important because even if its variance is low, it is explaining some variance in the data. \n\n:::",
    "supporting": [
      "Analysis_PCA_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}